# 名刺管理アプリ 実装スタートガイド

**作成日:** 2025年1月17日  
**バージョン:** 1.0

---

## 目次

1. [概要](#1-概要)
2. [環境構築](#2-環境構築)
3. [ディレクトリ構成](#3-ディレクトリ構成)
4. [ルーティング定義](#4-ルーティング定義)
5. [Zustandストア設計](#5-zustandストア設計)
6. [主要コンポーネント型定義](#6-主要コンポーネント型定義)
7. [実装フェーズ](#7-実装フェーズ)
8. [命名規則・コーディング規約](#8-命名規則コーディング規約)

---

## 1. 概要

### 1.1 本ドキュメントの目的

本ドキュメントは、Claude Codeで名刺管理アプリを実装するための具体的な指示書である。要件定義書・設計書・Skill定義書と合わせて使用する。

### 1.2 技術スタック確認

| 技術 | バージョン | 用途 |
|------|------------|------|
| React | 18.x | UIフレームワーク |
| TypeScript | 5.x | 型安全 |
| Vite | 5.x | ビルドツール |
| Tailwind CSS | 3.x | スタイリング |
| Zustand | 4.x | 状態管理 |
| Dexie.js | 4.x | IndexedDB操作 |
| React Router | 6.x | ルーティング |
| Google Gemini API | 1.5 Pro | OCR & 構造化 |
| axios | 1.x | HTTP通信 |
| bcryptjs | 2.x | パスワードハッシュ |
| react-window | 1.x | 仮想スクロール |
| @dnd-kit | 6.x | ドラッグ&ドロップ |
| JSZip | 3.x | ZIP処理 |
| browser-image-compression | 2.x | 画像圧縮 |

---

## 2. 環境構築

### 2.1 package.json

```json
{
  "name": "my-card-manager",
  "private": true,
  "version": "1.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "preview": "vite preview",
    "lint": "eslint . --ext ts,tsx --report-unused-disable-directives --max-warnings 0",
    "test": "vitest",
    "test:ui": "vitest --ui"
  },
  "dependencies": {
    "react": "^18.3.1",
    "react-dom": "^18.3.1",
    "react-router-dom": "^6.22.0",
    "zustand": "^4.5.0",
    "dexie": "^4.0.4",
    "dexie-react-hooks": "^1.1.7",
    "axios": "^1.6.7",
    "bcryptjs": "^2.4.3",
    "tesseract.js": "^5.0.4",
    "browser-image-compression": "^2.0.2",
    "react-window": "^1.8.10",
    "@dnd-kit/core": "^6.1.0",
    "@dnd-kit/sortable": "^8.0.0",
    "@dnd-kit/utilities": "^3.2.2",
    "jszip": "^3.10.1",
    "crypto-js": "^4.2.0",
    "date-fns": "^3.3.1",
    "lucide-react": "^0.323.0",
    "clsx": "^2.1.0",
    "uuid": "^9.0.1",
    "@google/generative-ai": "^0.1.0"
  },
  "devDependencies": {
    "@types/react": "^18.3.1",
    "@types/react-dom": "^18.3.0",
    "@types/bcryptjs": "^2.4.6",
    "@types/crypto-js": "^4.2.2",
    "@types/uuid": "^9.0.8",
    "@types/react-window": "^1.8.8",
    "@typescript-eslint/eslint-plugin": "^7.0.1",
    "@typescript-eslint/parser": "^7.0.1",
    "@vitejs/plugin-react": "^4.2.1",
    "autoprefixer": "^10.4.17",
    "eslint": "^8.56.0",
    "eslint-plugin-react-hooks": "^4.6.0",
    "eslint-plugin-react-refresh": "^0.4.5",
    "postcss": "^8.4.35",
    "tailwindcss": "^3.4.1",
    "typescript": "^5.3.3",
    "vite": "^5.1.0",
    "vitest": "^1.2.2",
    "@vitest/ui": "^1.2.2"
  }
}
```

### 2.2 vite.config.ts

```typescript
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';
import path from 'path';

export default defineConfig({
  plugins: [react()],
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
      '@components': path.resolve(__dirname, './src/components'),
      '@hooks': path.resolve(__dirname, './src/hooks'),
      '@stores': path.resolve(__dirname, './src/stores'),
      '@services': path.resolve(__dirname, './src/services'),
      '@types': path.resolve(__dirname, './src/types'),
      '@utils': path.resolve(__dirname, './src/utils'),
      '@constants': path.resolve(__dirname, './src/constants'),
      '@pages': path.resolve(__dirname, './src/pages'),
    },
  },
  server: {
    port: 3000,
  },
});
```

### 2.3 tsconfig.json

```json
{
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "skipLibCheck": true,
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "react-jsx",
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    "baseUrl": ".",
    "paths": {
      "@/*": ["src/*"],
      "@components/*": ["src/components/*"],
      "@hooks/*": ["src/hooks/*"],
      "@stores/*": ["src/stores/*"],
      "@services/*": ["src/services/*"],
      "@types/*": ["src/types/*"],
      "@utils/*": ["src/utils/*"],
      "@constants/*": ["src/constants/*"],
      "@pages/*": ["src/pages/*"]
    }
  },
  "include": ["src"],
  "references": [{ "path": "./tsconfig.node.json" }]
}
```

### 2.4 tailwind.config.js

```javascript
/** @type {import('tailwindcss').Config} */
export default {
  content: [
    "./index.html",
    "./src/**/*.{js,ts,jsx,tsx}",
  ],
  darkMode: 'class',
  theme: {
    extend: {
      colors: {
        primary: {
          50: '#eff6ff',
          100: '#dbeafe',
          200: '#bfdbfe',
          300: '#93c5fd',
          400: '#60a5fa',
          500: '#3b82f6',
          600: '#2563eb',
          700: '#1d4ed8',
          800: '#1e40af',
          900: '#1e3a8a',
        },
      },
    },
  },
  plugins: [],
}
```

### 2.5 初期セットアップコマンド

```bash
# プロジェクト作成
npm create vite@latest my-card-manager -- --template react-ts
cd my-card-manager

# 依存関係インストール
npm install

# Tailwind CSS初期化
npx tailwindcss init -p

# 開発サーバー起動
npm run dev
```

---

## 3. ディレクトリ構成

```
src/
├── components/                 # UIコンポーネント
│   ├── common/                 # 共通コンポーネント
│   │   ├── Button/
│   │   │   ├── Button.tsx
│   │   │   └── index.ts
│   │   ├── Modal/
│   │   │   ├── Modal.tsx
│   │   │   ├── ConfirmModal.tsx
│   │   │   └── index.ts
│   │   ├── Toast/
│   │   │   ├── Toast.tsx
│   │   │   ├── ToastContainer.tsx
│   │   │   └── index.ts
│   │   ├── Loading/
│   │   │   ├── Spinner.tsx
│   │   │   ├── ProgressBar.tsx
│   │   │   └── index.ts
│   │   ├── Form/
│   │   │   ├── Input.tsx
│   │   │   ├── Select.tsx
│   │   │   ├── Checkbox.tsx
│   │   │   ├── DatePicker.tsx
│   │   │   ├── StarRating.tsx
│   │   │   └── index.ts
│   │   └── index.ts
│   │
│   ├── layout/                 # レイアウトコンポーネント
│   │   ├── Header/
│   │   │   ├── Header.tsx
│   │   │   ├── SearchBar.tsx
│   │   │   ├── UserMenu.tsx
│   │   │   └── index.ts
│   │   ├── Sidebar/
│   │   │   ├── Sidebar.tsx
│   │   │   ├── ProfileCard.tsx
│   │   │   └── index.ts
│   │   ├── MainLayout.tsx
│   │   └── AuthLayout.tsx
│   │
│   ├── dashboard/              # ダッシュボード関連
│   │   ├── CardList/
│   │   │   ├── CardList.tsx
│   │   │   ├── CardListItem.tsx
│   │   │   ├── CardListHeader.tsx
│   │   │   ├── BulkActionBar.tsx
│   │   │   └── index.ts
│   │   ├── FilterBar/
│   │   │   ├── FilterBar.tsx
│   │   │   ├── FilterDropdown.tsx
│   │   │   └── index.ts
│   │   ├── ProfilePanel/
│   │   │   ├── ProfilePanel.tsx
│   │   │   ├── ProfileItem.tsx
│   │   │   └── index.ts
│   │   └── Pagination/
│   │       ├── Pagination.tsx
│   │       └── index.ts
│   │
│   ├── card/                   # 名刺関連
│   │   ├── CardDetail/
│   │   │   ├── CardDetail.tsx
│   │   │   ├── CardImageViewer.tsx
│   │   │   ├── CardInfoSection.tsx
│   │   │   └── index.ts
│   │   ├── CardForm/
│   │   │   ├── CardForm.tsx
│   │   │   ├── ImageUploader.tsx
│   │   │   ├── OcrProgress.tsx
│   │   │   ├── TagSelector.tsx
│   │   │   └── index.ts
│   │   ├── CardImage/
│   │   │   ├── CardThumbnail.tsx
│   │   │   ├── ImageLightbox.tsx
│   │   │   └── index.ts
│   │   └── DuplicateCheck/
│   │       ├── DuplicateModal.tsx
│   │       ├── CardComparison.tsx
│   │       └── index.ts
│   │
│   ├── auth/                   # 認証関連
│   │   ├── LoginForm/
│   │   │   ├── LoginForm.tsx
│   │   │   └── index.ts
│   │   ├── RegisterForm/
│   │   │   ├── RegisterForm.tsx
│   │   │   ├── PasswordStrength.tsx
│   │   │   └── index.ts
│   │   └── SessionWarning/
│   │       ├── SessionWarningModal.tsx
│   │       └── index.ts
│   │
│   ├── settings/               # 設定関連
│   │   ├── SettingsForm/
│   │   │   ├── SettingsForm.tsx
│   │   │   ├── AccountSection.tsx
│   │   │   ├── DisplaySection.tsx
│   │   │   ├── SecuritySection.tsx
│   │   │   ├── AiSection.tsx
│   │   │   └── index.ts
│   │   ├── PasswordChange/
│   │   │   ├── PasswordChangeModal.tsx
│   │   │   └── index.ts
│   │   ├── BackupPanel/
│   │   │   ├── BackupPanel.tsx
│   │   │   ├── BackupHistory.tsx
│   │   │   ├── RestorePreview.tsx
│   │   │   └── index.ts
│   │   └── ExportPanel/
│   │       ├── CsvExportModal.tsx
│   │       └── index.ts
│   │
│   ├── profile/                # 所属管理関連
│   │   ├── ProfileList/
│   │   │   ├── ProfileList.tsx
│   │   │   ├── ProfileListItem.tsx
│   │   │   └── index.ts
│   │   ├── ProfileForm/
│   │   │   ├── ProfileFormModal.tsx
│   │   │   └── index.ts
│   │   └── ProfileDelete/
│   │       ├── ProfileDeleteModal.tsx
│   │       └── index.ts
│   │
│   └── tag/                    # タグ管理関連
│       ├── TagList/
│       │   ├── TagList.tsx
│       │   ├── TagListItem.tsx
│       │   └── index.ts
│       ├── TagForm/
│       │   ├── TagFormModal.tsx
│       │   ├── ColorPicker.tsx
│       │   └── index.ts
│       └── index.ts
│
├── hooks/                      # カスタムフック
│   ├── useAuth.ts              # 認証関連
│   ├── useSession.ts           # セッション管理
│   ├── useCards.ts             # 名刺CRUD
│   ├── useProfiles.ts          # 所属CRUD
│   ├── useTags.ts              # タグCRUD
│   ├── useFilter.ts            # フィルター状態
│   ├── useSort.ts              # ソート状態
│   ├── usePagination.ts        # ページネーション
│   ├── useOcr.ts               # OCR処理
│   ├── useToast.ts             # トースト通知
│   ├── useDebounce.ts          # デバウンス
│   └── index.ts
│
├── stores/                     # Zustandストア
│   ├── authStore.ts            # 認証状態
│   ├── cardStore.ts            # 名刺データ
│   ├── profileStore.ts         # 所属データ
│   ├── tagStore.ts             # タグデータ
│   ├── filterStore.ts          # フィルター状態
│   ├── uiStore.ts              # UI状態（モーダル、トースト等）
│   ├── settingsStore.ts        # ユーザー設定
│   └── index.ts
│
├── services/                   # ビジネスロジック
│   ├── db/                     # IndexedDB操作
│   │   ├── index.ts            # Dexieインスタンス
│   │   ├── migrations.ts       # DBマイグレーション
│   │   ├── userService.ts
│   │   ├── sessionService.ts
│   │   ├── profileService.ts
│   │   ├── cardService.ts
│   │   ├── tagService.ts
│   │   └── settingsService.ts
│   │
│   ├── auth/                   # 認証処理
│   │   ├── authService.ts
│   │   ├── passwordService.ts
│   │   └── sessionManager.ts
│   │
│   ├── skills/                 # AIスキル
│   │   ├── orchestrator.ts     # スキル統合
│   │   ├── ocrSkill.ts         # SK-001
│   │   ├── structureSkill.ts   # SK-002
│   │   ├── duplicateSkill.ts   # SK-003
│   │   ├── searchSkill.ts      # SK-004
│   │   ├── companySkill.ts     # SK-005
│   │   ├── tagSuggestionSkill.ts # SK-006
│   │   ├── prioritySkill.ts    # SK-007
│   │   ├── imagePreprocessSkill.ts # SK-008
│   │   └── index.ts
│   │
│   ├── api/                    # 外部API通信
│   │   ├── cloudVisionApi.ts
│   │   ├── claudeApi.ts
│   │   ├── companyApi.ts
│   │   └── index.ts
│   │
│   ├── backup/                 # バックアップ処理
│   │   ├── backupService.ts
│   │   ├── restoreService.ts
│   │   └── migrationService.ts
│   │
│   └── export/                 # エクスポート処理
│       ├── csvExportService.ts
│       └── index.ts
│
├── types/                      # 型定義
│   ├── models.ts               # データモデル型
│   ├── api.ts                  # API関連型
│   ├── skills.ts               # スキル関連型
│   ├── store.ts                # ストア関連型
│   ├── components.ts           # コンポーネントProps型
│   └── index.ts
│
├── constants/                  # 定数定義
│   ├── masters.ts              # マスタデータ
│   ├── routes.ts               # ルート定義
│   ├── messages.ts             # メッセージ定義
│   ├── validation.ts           # バリデーションルール
│   └── index.ts
│
├── utils/                      # ユーティリティ
│   ├── validation.ts           # バリデーション関数
│   ├── format.ts               # フォーマット関数
│   ├── crypto.ts               # 暗号化関連
│   ├── date.ts                 # 日付操作
│   ├── string.ts               # 文字列操作
│   └── index.ts
│
├── pages/                      # ページコンポーネント
│   ├── LoginPage.tsx
│   ├── RegisterPage.tsx
│   ├── DashboardPage.tsx
│   ├── CardDetailPage.tsx
│   ├── CardCreatePage.tsx
│   ├── ProfileManagePage.tsx
│   ├── TagManagePage.tsx
│   ├── DuplicateCheckPage.tsx
│   ├── SettingsPage.tsx
│   ├── BackupPage.tsx
│   └── NotFoundPage.tsx
│
├── App.tsx                     # ルートコンポーネント
├── main.tsx                    # エントリポイント
└── index.css                   # グローバルスタイル
```

---

## 4. ルーティング定義

### 4.1 ルート一覧

| パス | ページ | 認証 | 説明 |
|------|--------|------|------|
| `/login` | LoginPage | 不要 | ログイン |
| `/register` | RegisterPage | 不要 | 新規登録 |
| `/` | DashboardPage | 必要 | ダッシュボード（名刺一覧） |
| `/cards/new` | CardCreatePage | 必要 | 名刺登録 |
| `/cards/:id` | CardDetailPage | 必要 | 名刺詳細 |
| `/cards/:id/edit` | CardCreatePage | 必要 | 名刺編集（登録と共用） |
| `/profiles` | ProfileManagePage | 必要 | 所属管理 |
| `/tags` | TagManagePage | 必要 | タグ管理 |
| `/duplicates` | DuplicateCheckPage | 必要 | 重複確認 |
| `/settings` | SettingsPage | 必要 | 設定 |
| `/backup` | BackupPage | 必要 | バックアップ・復元 |
| `*` | NotFoundPage | − | 404ページ |

### 4.2 ルート定義ファイル（constants/routes.ts）

```typescript
export const ROUTES = {
  LOGIN: '/login',
  REGISTER: '/register',
  DASHBOARD: '/',
  CARD_CREATE: '/cards/new',
  CARD_DETAIL: '/cards/:id',
  CARD_EDIT: '/cards/:id/edit',
  PROFILES: '/profiles',
  TAGS: '/tags',
  DUPLICATES: '/duplicates',
  SETTINGS: '/settings',
  BACKUP: '/backup',
} as const;

export const PUBLIC_ROUTES = [ROUTES.LOGIN, ROUTES.REGISTER];

export const buildCardDetailPath = (id: string) => `/cards/${id}`;
export const buildCardEditPath = (id: string) => `/cards/${id}/edit`;
```

### 4.3 ルーター実装（App.tsx）

```typescript
import { BrowserRouter, Routes, Route, Navigate } from 'react-router-dom';
import { useAuthStore } from '@stores/authStore';
import { ROUTES, PUBLIC_ROUTES } from '@constants/routes';
import { MainLayout } from '@components/layout/MainLayout';
import { AuthLayout } from '@components/layout/AuthLayout';

// ページインポート
import { LoginPage } from '@pages/LoginPage';
import { RegisterPage } from '@pages/RegisterPage';
import { DashboardPage } from '@pages/DashboardPage';
import { CardDetailPage } from '@pages/CardDetailPage';
import { CardCreatePage } from '@pages/CardCreatePage';
import { ProfileManagePage } from '@pages/ProfileManagePage';
import { TagManagePage } from '@pages/TagManagePage';
import { DuplicateCheckPage } from '@pages/DuplicateCheckPage';
import { SettingsPage } from '@pages/SettingsPage';
import { BackupPage } from '@pages/BackupPage';
import { NotFoundPage } from '@pages/NotFoundPage';

// 認証ガード
const PrivateRoute = ({ children }: { children: React.ReactNode }) => {
  const { isAuthenticated } = useAuthStore();
  
  if (!isAuthenticated) {
    return <Navigate to={ROUTES.LOGIN} replace />;
  }
  
  return <>{children}</>;
};

// 認証済みユーザーのリダイレクト
const PublicRoute = ({ children }: { children: React.ReactNode }) => {
  const { isAuthenticated } = useAuthStore();
  
  if (isAuthenticated) {
    return <Navigate to={ROUTES.DASHBOARD} replace />;
  }
  
  return <>{children}</>;
};

export const App = () => {
  return (
    <BrowserRouter>
      <Routes>
        {/* 認証不要ページ */}
        <Route element={<AuthLayout />}>
          <Route
            path={ROUTES.LOGIN}
            element={
              <PublicRoute>
                <LoginPage />
              </PublicRoute>
            }
          />
          <Route
            path={ROUTES.REGISTER}
            element={
              <PublicRoute>
                <RegisterPage />
              </PublicRoute>
            }
          />
        </Route>

        {/* 認証必要ページ */}
        <Route
          element={
            <PrivateRoute>
              <MainLayout />
            </PrivateRoute>
          }
        >
          <Route path={ROUTES.DASHBOARD} element={<DashboardPage />} />
          <Route path={ROUTES.CARD_CREATE} element={<CardCreatePage />} />
          <Route path={ROUTES.CARD_DETAIL} element={<CardDetailPage />} />
          <Route path={ROUTES.CARD_EDIT} element={<CardCreatePage />} />
          <Route path={ROUTES.PROFILES} element={<ProfileManagePage />} />
          <Route path={ROUTES.TAGS} element={<TagManagePage />} />
          <Route path={ROUTES.DUPLICATES} element={<DuplicateCheckPage />} />
          <Route path={ROUTES.SETTINGS} element={<SettingsPage />} />
          <Route path={ROUTES.BACKUP} element={<BackupPage />} />
        </Route>

        {/* 404 */}
        <Route path="*" element={<NotFoundPage />} />
      </Routes>
    </BrowserRouter>
  );
};
```

---

## 5. Zustandストア設計

### 5.1 authStore.ts

```typescript
import { create } from 'zustand';
import { persist } from 'zustand/middleware';
import type { User } from '@types/models';

interface AuthState {
  // 状態
  user: User | null;
  isAuthenticated: boolean;
  isLoading: boolean;
  error: string | null;

  // アクション
  login: (email: string, password: string) => Promise<boolean>;
  logout: () => Promise<void>;
  register: (email: string, password: string) => Promise<boolean>;
  checkSession: () => Promise<void>;
  clearError: () => void;
}

export const useAuthStore = create<AuthState>()(
  persist(
    (set, get) => ({
      // 初期状態
      user: null,
      isAuthenticated: false,
      isLoading: false,
      error: null,

      // アクション
      login: async (email, password) => {
        set({ isLoading: true, error: null });
        try {
          // authService.login() を呼び出し
          const user = await authService.login(email, password);
          set({ user, isAuthenticated: true, isLoading: false });
          return true;
        } catch (error) {
          set({ error: (error as Error).message, isLoading: false });
          return false;
        }
      },

      logout: async () => {
        await authService.logout();
        set({ user: null, isAuthenticated: false });
      },

      register: async (email, password) => {
        set({ isLoading: true, error: null });
        try {
          const user = await authService.register(email, password);
          set({ user, isAuthenticated: true, isLoading: false });
          return true;
        } catch (error) {
          set({ error: (error as Error).message, isLoading: false });
          return false;
        }
      },

      checkSession: async () => {
        const session = await sessionService.getValidSession();
        if (session) {
          const user = await userService.getById(session.userId);
          set({ user, isAuthenticated: true });
        } else {
          set({ user: null, isAuthenticated: false });
        }
      },

      clearError: () => set({ error: null }),
    }),
    {
      name: 'auth-storage',
      partialize: (state) => ({ isAuthenticated: state.isAuthenticated }),
    }
  )
);
```

### 5.2 cardStore.ts

```typescript
import { create } from 'zustand';
import type { BusinessCard, SortConfig, FilterConfig } from '@types/models';

interface CardState {
  // 状態
  cards: BusinessCard[];
  selectedCards: Set<string>;
  currentCard: BusinessCard | null;
  isLoading: boolean;
  error: string | null;
  
  // ソート・フィルター
  sortConfig: SortConfig;
  filterConfig: FilterConfig;
  
  // ページネーション
  page: number;
  pageSize: number;
  totalCount: number;

  // アクション - CRUD
  fetchCards: (profileId?: string) => Promise<void>;
  fetchCardById: (id: string) => Promise<void>;
  createCard: (data: Omit<BusinessCard, 'id' | 'createdAt' | 'updatedAt'>) => Promise<string>;
  updateCard: (id: string, data: Partial<BusinessCard>) => Promise<void>;
  deleteCard: (id: string) => Promise<void>;
  deleteCards: (ids: string[]) => Promise<void>;
  uploadImage: (cardId: string, file: File) => Promise<void>;
  deleteImage: (imageId: string) => Promise<void>;

  // アクション - 選択
  selectCard: (id: string) => void;
  deselectCard: (id: string) => void;
  selectAll: () => void;
  deselectAll: () => void;
  toggleSelection: (id: string) => void;

  // アクション - ソート・フィルター
  setSort: (config: SortConfig) => void;
  setFilter: (config: FilterConfig) => void;
  resetFilter: () => void;

  // アクション - ページネーション
  setPage: (page: number) => void;
  setPageSize: (size: number) => void;

  // アクション - その他
  clearError: () => void;
}

const DEFAULT_SORT: SortConfig = {
  field: 'exchangeDate',
  direction: 'desc',
};

const DEFAULT_FILTER: FilterConfig = {
  keyword: '',
  profileIds: [],
  priorities: [],
  tagIds: [],
  industries: [],
  areas: [],
  positionLevels: [],
  exchangeDateFrom: null,
  exchangeDateTo: null,
};

export const useCardStore = create<CardState>((set, get) => ({
  // 初期状態
  cards: [],
  selectedCards: new Set(),
  currentCard: null,
  isLoading: false,
  error: null,
  sortConfig: DEFAULT_SORT,
  filterConfig: DEFAULT_FILTER,
  page: 1,
  pageSize: 50,
  totalCount: 0,

  // CRUD アクション
  fetchCards: async (profileId) => {
    set({ isLoading: true, error: null });
    try {
      const { sortConfig, filterConfig, page, pageSize } = get();
      const result = await cardService.getCards({
        profileId,
        sort: sortConfig,
        filter: filterConfig,
        page,
        pageSize,
      });
      set({
        cards: result.cards,
        totalCount: result.totalCount,
        isLoading: false,
      });
    } catch (error) {
      set({ error: (error as Error).message, isLoading: false });
    }
  },

  fetchCardById: async (id) => {
    set({ isLoading: true, error: null });
    try {
      const card = await cardService.getById(id);
      set({ currentCard: card, isLoading: false });
    } catch (error) {
      set({ error: (error as Error).message, isLoading: false });
    }
  },

  createCard: async (data) => {
    set({ isLoading: true, error: null });
    try {
      const id = await cardService.create(data);
      await get().fetchCards();
      set({ isLoading: false });
      return id;
    } catch (error) {
      set({ error: (error as Error).message, isLoading: false });
      throw error;
    }
  },

  updateCard: async (id, data) => {
    set({ isLoading: true, error: null });
    try {
      await cardService.update(id, data);
      await get().fetchCards();
      set({ isLoading: false });
    } catch (error) {
      set({ error: (error as Error).message, isLoading: false });
      throw error;
    }
  },

  deleteCard: async (id) => {
    set({ isLoading: true, error: null });
    try {
      await cardService.delete(id);
      await get().fetchCards();
      set({ isLoading: false });
    } catch (error) {
      set({ error: (error as Error).message, isLoading: false });
      throw error;
    }
  },

  deleteCards: async (ids) => {
    set({ isLoading: true, error: null });
    try {
      await cardService.deleteMany(ids);
      set({ selectedCards: new Set() });
      await get().fetchCards();
      set({ isLoading: false });
    } catch (error) {
      set({ error: (error as Error).message, isLoading: false });
      throw error;
    }
  },

  // 選択アクション
  selectCard: (id) => {
    set((state) => ({
      selectedCards: new Set(state.selectedCards).add(id),
    }));
  },

  deselectCard: (id) => {
    set((state) => {
      const newSet = new Set(state.selectedCards);
      newSet.delete(id);
      return { selectedCards: newSet };
    });
  },

  selectAll: () => {
    set((state) => ({
      selectedCards: new Set(state.cards.map((c) => c.id)),
    }));
  },

  deselectAll: () => {
    set({ selectedCards: new Set() });
  },

  toggleSelection: (id) => {
    const { selectedCards } = get();
    if (selectedCards.has(id)) {
      get().deselectCard(id);
    } else {
      get().selectCard(id);
    }
  },

  // ソート・フィルターアクション
  setSort: (config) => {
    set({ sortConfig: config, page: 1 });
    get().fetchCards();
  },

  setFilter: (config) => {
    set({ filterConfig: config, page: 1 });
    get().fetchCards();
  },

  resetFilter: () => {
    set({ filterConfig: DEFAULT_FILTER, page: 1 });
    get().fetchCards();
  },

  // ページネーションアクション
  setPage: (page) => {
    set({ page });
    get().fetchCards();
  },

  setPageSize: (size) => {
    set({ pageSize: size, page: 1 });
    get().fetchCards();
  },

  clearError: () => set({ error: null }),
}));
```

### 5.3 profileStore.ts

```typescript
import { create } from 'zustand';
import type { MyProfile } from '@types/models';

interface ProfileState {
  profiles: MyProfile[];
  selectedProfileId: string | null;
  isLoading: boolean;
  error: string | null;

  fetchProfiles: () => Promise<void>;
  createProfile: (data: Omit<MyProfile, 'id' | 'createdAt' | 'updatedAt'>) => Promise<string>;
  updateProfile: (id: string, data: Partial<MyProfile>) => Promise<void>;
  deleteProfile: (id: string, action: 'deleteCards' | 'moveCards', targetId?: string) => Promise<void>;
  reorderProfiles: (profileIds: string[]) => Promise<void>;
  selectProfile: (id: string | null) => void;
  clearError: () => void;
}

export const useProfileStore = create<ProfileState>((set, get) => ({
  profiles: [],
  selectedProfileId: null,
  isLoading: false,
  error: null,

  fetchProfiles: async () => {
    set({ isLoading: true, error: null });
    try {
      const profiles = await profileService.getAll();
      set({ profiles, isLoading: false });
    } catch (error) {
      set({ error: (error as Error).message, isLoading: false });
    }
  },

  createProfile: async (data) => {
    set({ isLoading: true, error: null });
    try {
      const id = await profileService.create(data);
      await get().fetchProfiles();
      set({ isLoading: false });
      return id;
    } catch (error) {
      set({ error: (error as Error).message, isLoading: false });
      throw error;
    }
  },

  updateProfile: async (id, data) => {
    set({ isLoading: true, error: null });
    try {
      await profileService.update(id, data);
      await get().fetchProfiles();
      set({ isLoading: false });
    } catch (error) {
      set({ error: (error as Error).message, isLoading: false });
      throw error;
    }
  },

  deleteProfile: async (id, action, targetId) => {
    set({ isLoading: true, error: null });
    try {
      await profileService.delete(id, action, targetId);
      const { selectedProfileId } = get();
      if (selectedProfileId === id) {
        set({ selectedProfileId: null });
      }
      await get().fetchProfiles();
      set({ isLoading: false });
    } catch (error) {
      set({ error: (error as Error).message, isLoading: false });
      throw error;
    }
  },

  reorderProfiles: async (profileIds) => {
    try {
      await profileService.reorder(profileIds);
      await get().fetchProfiles();
    } catch (error) {
      set({ error: (error as Error).message });
    }
  },

  selectProfile: (id) => set({ selectedProfileId: id }),

  clearError: () => set({ error: null }),
}));
```

### 5.4 tagStore.ts

```typescript
import { create } from 'zustand';
import type { Tag } from '@types/models';

interface TagState {
  tags: Tag[];
  isLoading: boolean;
  error: string | null;

  fetchTags: () => Promise<void>;
  createTag: (data: { name: string; color?: string }) => Promise<string>;
  updateTag: (id: string, data: Partial<Tag>) => Promise<void>;
  deleteTag: (id: string) => Promise<void>;
  addTagToCards: (tagId: string, cardIds: string[]) => Promise<void>;
  removeTagFromCard: (tagId: string, cardId: string) => Promise<void>;
  clearError: () => void;
}

export const useTagStore = create<TagState>((set, get) => ({
  tags: [],
  isLoading: false,
  error: null,

  fetchTags: async () => {
    set({ isLoading: true, error: null });
    try {
      const tags = await tagService.getAll();
      set({ tags, isLoading: false });
    } catch (error) {
      set({ error: (error as Error).message, isLoading: false });
    }
  },

  createTag: async (data) => {
    set({ isLoading: true, error: null });
    try {
      const id = await tagService.create(data);
      await get().fetchTags();
      set({ isLoading: false });
      return id;
    } catch (error) {
      set({ error: (error as Error).message, isLoading: false });
      throw error;
    }
  },

  updateTag: async (id, data) => {
    set({ isLoading: true, error: null });
    try {
      await tagService.update(id, data);
      await get().fetchTags();
      set({ isLoading: false });
    } catch (error) {
      set({ error: (error as Error).message, isLoading: false });
      throw error;
    }
  },

  deleteTag: async (id) => {
    set({ isLoading: true, error: null });
    try {
      await tagService.delete(id);
      await get().fetchTags();
      set({ isLoading: false });
    } catch (error) {
      set({ error: (error as Error).message, isLoading: false });
      throw error;
    }
  },

  addTagToCards: async (tagId, cardIds) => {
    try {
      await tagService.addToCards(tagId, cardIds);
    } catch (error) {
      set({ error: (error as Error).message });
    }
  },

  removeTagFromCard: async (tagId, cardId) => {
    try {
      await tagService.removeFromCard(tagId, cardId);
    } catch (error) {
      set({ error: (error as Error).message });
    }
  },

  clearError: () => set({ error: null }),
}));
```

### 5.5 uiStore.ts

```typescript
import { create } from 'zustand';

interface Toast {
  id: string;
  type: 'success' | 'error' | 'warning' | 'info';
  message: string;
  duration?: number;
}

interface Modal {
  type: string;
  props?: Record<string, unknown>;
}

interface UIState {
  // トースト
  toasts: Toast[];
  addToast: (toast: Omit<Toast, 'id'>) => void;
  removeToast: (id: string) => void;

  // モーダル
  activeModal: Modal | null;
  openModal: (type: string, props?: Record<string, unknown>) => void;
  closeModal: () => void;

  // サイドバー
  isSidebarOpen: boolean;
  toggleSidebar: () => void;
  setSidebarOpen: (open: boolean) => void;

  // ローディング
  globalLoading: boolean;
  setGlobalLoading: (loading: boolean) => void;

  // セッション警告
  showSessionWarning: boolean;
  sessionRemainingTime: number;
  setSessionWarning: (show: boolean, remainingTime?: number) => void;
}

export const useUIStore = create<UIState>((set) => ({
  // トースト
  toasts: [],
  addToast: (toast) => {
    const id = crypto.randomUUID();
    set((state) => ({
      toasts: [...state.toasts, { ...toast, id }],
    }));
    
    // 自動削除
    const duration = toast.duration ?? 5000;
    if (duration > 0) {
      setTimeout(() => {
        set((state) => ({
          toasts: state.toasts.filter((t) => t.id !== id),
        }));
      }, duration);
    }
  },
  removeToast: (id) => {
    set((state) => ({
      toasts: state.toasts.filter((t) => t.id !== id),
    }));
  },

  // モーダル
  activeModal: null,
  openModal: (type, props) => set({ activeModal: { type, props } }),
  closeModal: () => set({ activeModal: null }),

  // サイドバー
  isSidebarOpen: true,
  toggleSidebar: () => set((state) => ({ isSidebarOpen: !state.isSidebarOpen })),
  setSidebarOpen: (open) => set({ isSidebarOpen: open }),

  // ローディング
  globalLoading: false,
  setGlobalLoading: (loading) => set({ globalLoading: loading }),

  // セッション警告
  showSessionWarning: false,
  sessionRemainingTime: 0,
  setSessionWarning: (show, remainingTime = 0) =>
    set({ showSessionWarning: show, sessionRemainingTime: remainingTime }),
}));
```

### 5.6 settingsStore.ts

```typescript
import { create } from 'zustand';
import type { UserSetting } from '@types/models';

interface SettingsState {
  settings: UserSetting | null;
  isLoading: boolean;
  error: string | null;

  fetchSettings: () => Promise<void>;
  updateSettings: (data: Partial<UserSetting>) => Promise<void>;
  clearError: () => void;
}

export const useSettingsStore = create<SettingsState>((set, get) => ({
  settings: null,
  isLoading: false,
  error: null,

  fetchSettings: async () => {
    set({ isLoading: true, error: null });
    try {
      const settings = await settingsService.get();
      set({ settings, isLoading: false });
    } catch (error) {
      set({ error: (error as Error).message, isLoading: false });
    }
  },

  updateSettings: async (data) => {
    set({ isLoading: true, error: null });
    try {
      await settingsService.update(data);
      await get().fetchSettings();
      set({ isLoading: false });
    } catch (error) {
      set({ error: (error as Error).message, isLoading: false });
      throw error;
    }
  },

  clearError: () => set({ error: null }),
}));
```

---

## 6. 主要コンポーネント型定義

### 6.1 types/models.ts

```typescript
// ============================================
// データモデル型定義
// ============================================

// ユーザー
export interface User {
  id: string;
  email: string;
  createdAt: Date;
  updatedAt: Date;
  lastLoginAt?: Date;
}

// セッション
export interface Session {
  id: string;
  userId: string;
  token: string;
  expiresAt: Date;
  createdAt: Date;
}

// ユーザー設定
export interface UserSetting {
  id: string;
  userId: string;
  sessionTimeout: number;
  defaultPriority: Priority;
  listPageSize: number;
  theme: 'light' | 'dark';
  ocrLanguages: OcrLanguage[];
  cloudOcrProvider: CloudOcrProvider;
  cloudOcrApiKey: string | null;
  llmProvider: LlmProvider;
  llmApiKey: string | null;
  enableAiFeatures: boolean;
  enableCompanyLookup: boolean;
  createdAt: Date;
  updatedAt: Date;
}

// 自分の所属
export interface MyProfile {
  id: string;
  userId: string;
  companyName: string;
  position?: string;
  email?: string;
  phone?: string;
  address?: string;
  startDate?: string;
  endDate?: string;
  isCurrent: boolean;
  cardImage?: Blob;
  displayOrder: number;
  createdAt: Date;
  updatedAt: Date;
}

// 相手の名刺
export interface BusinessCard {
  id: string;
  profileId: string;
  personName: string;
  personNameKana?: string;
  companyName: string;
  department?: string;
  position?: string;
  email?: string;
  phone?: string;
  mobile?: string;
  fax?: string;
  address?: string;
  postalCode?: string;
  website?: string;
  industry?: Industry;
  area?: string;
  positionLevel?: PositionLevel;
  exchangeDate?: Date;
  meetingPlace?: string;
  memo?: string;
  priority: Priority;
  createdAt: Date;
  updatedAt: Date;
}

// 名刺画像
export interface BusinessCardImage {
  id: string;
  cardId: string;
  imageData: Blob;
  imageType: 'front' | 'back' | 'other';
  displayOrder: number;
  createdAt: Date;
}

// タグ
export interface Tag {
  id: string;
  userId: string;
  name: string;
  color?: string;
  createdAt: Date;
  updatedAt: Date;
}

// 名刺-タグ紐付け
export interface CardTag {
  cardId: string;
  tagId: string;
  createdAt: Date;
}

// 重複スキップ
export interface DuplicateSkip {
  cardId1: string;
  cardId2: string;
  createdAt: Date;
}

// バックアップ履歴
export interface BackupHistory {
  id: string;
  userId: string;
  backupType: 'json' | 'zip';
  schemaVersion: string;
  cardCount: number;
  fileSize: number;
  createdAt: Date;
}

// ============================================
// Enum / Union型
// ============================================

export type Priority = 1 | 2 | 3 | 4 | 5;

export type Industry =
  | 'IT'
  | 'FINANCE'
  | 'MANUFACTURING'
  | 'RETAIL'
  | 'SERVICE'
  | 'CONSTRUCTION'
  | 'MEDICAL'
  | 'EDUCATION'
  | 'GOVERNMENT'
  | 'OTHER';

export type PositionLevel =
  | 'EXECUTIVE'
  | 'DIRECTOR'
  | 'MANAGER'
  | 'SECTION_CHIEF'
  | 'STAFF'
  | 'OTHER';

export type OcrLanguage = 'ja' | 'en' | 'zh' | 'ko';

export type CloudOcrProvider = 'google' | 'azure' | 'aws';

export type LlmProvider = 'anthropic' | 'openai' | 'google';

// ============================================
// フィルター・ソート
// ============================================

export interface SortConfig {
  field: keyof BusinessCard | 'profileName';
  direction: 'asc' | 'desc';
}

export interface FilterConfig {
  keyword: string;
  profileIds: string[];
  priorities: Priority[];
  tagIds: string[];
  industries: Industry[];
  areas: string[];
  positionLevels: PositionLevel[];
  exchangeDateFrom: Date | null;
  exchangeDateTo: Date | null;
}

// ============================================
// 拡張型（リレーション込み）
// ============================================

export interface BusinessCardWithRelations extends BusinessCard {
  profile?: MyProfile;
  tags?: Tag[];
  images?: BusinessCardImage[];
}

export interface MyProfileWithStats extends MyProfile {
  cardCount: number;
}

export interface TagWithStats extends Tag {
  cardCount: number;
}
```

### 6.2 types/components.ts

```typescript
import type { ReactNode } from 'react';
import type {
  BusinessCard,
  BusinessCardWithRelations,
  MyProfile,
  Tag,
  Priority,
  SortConfig,
  FilterConfig,
} from './models';

// ============================================
// 共通コンポーネント Props
// ============================================

// Button
export interface ButtonProps {
  children: ReactNode;
  variant?: 'primary' | 'secondary' | 'danger' | 'ghost';
  size?: 'sm' | 'md' | 'lg';
  disabled?: boolean;
  loading?: boolean;
  type?: 'button' | 'submit' | 'reset';
  onClick?: () => void;
  className?: string;
}

// Modal
export interface ModalProps {
  isOpen: boolean;
  onClose: () => void;
  title?: string;
  children: ReactNode;
  size?: 'sm' | 'md' | 'lg' | 'xl';
  closeOnOverlay?: boolean;
}

// ConfirmModal
export interface ConfirmModalProps {
  isOpen: boolean;
  onClose: () => void;
  onConfirm: () => void;
  title: string;
  message: string;
  confirmText?: string;
  cancelText?: string;
  variant?: 'danger' | 'warning' | 'info';
  loading?: boolean;
}

// Input
export interface InputProps {
  label?: string;
  error?: string;
  helperText?: string;
  required?: boolean;
  disabled?: boolean;
  type?: 'text' | 'email' | 'password' | 'tel' | 'url';
  value: string;
  onChange: (value: string) => void;
  placeholder?: string;
  className?: string;
}

// Select
export interface SelectOption {
  value: string;
  label: string;
}

export interface SelectProps {
  label?: string;
  error?: string;
  required?: boolean;
  disabled?: boolean;
  options: SelectOption[];
  value: string | string[];
  onChange: (value: string | string[]) => void;
  multiple?: boolean;
  placeholder?: string;
  className?: string;
}

// StarRating
export interface StarRatingProps {
  value: Priority;
  onChange?: (value: Priority) => void;
  readonly?: boolean;
  size?: 'sm' | 'md' | 'lg';
}

// ============================================
// レイアウト Props
// ============================================

// Header
export interface HeaderProps {
  onSearch: (keyword: string) => void;
  onCreateCard: () => void;
  onOpenSettings: () => void;
  onLogout: () => void;
}

// Sidebar
export interface SidebarProps {
  profiles: MyProfile[];
  selectedProfileId: string | null;
  onSelectProfile: (id: string | null) => void;
  onManageProfiles: () => void;
  totalCardCount: number;
}

// ============================================
// ダッシュボード Props
// ============================================

// CardList
export interface CardListProps {
  cards: BusinessCardWithRelations[];
  selectedIds: Set<string>;
  onSelect: (id: string) => void;
  onSelectAll: () => void;
  onDeselectAll: () => void;
  onCardClick: (id: string) => void;
  sortConfig: SortConfig;
  onSort: (config: SortConfig) => void;
  isLoading?: boolean;
}

// CardListItem
export interface CardListItemProps {
  card: BusinessCardWithRelations;
  isSelected: boolean;
  onSelect: () => void;
  onClick: () => void;
}

// FilterBar
export interface FilterBarProps {
  filterConfig: FilterConfig;
  onFilterChange: (config: FilterConfig) => void;
  onReset: () => void;
  tags: Tag[];
}

// BulkActionBar
export interface BulkActionBarProps {
  selectedCount: number;
  onAddTag: () => void;
  onExport: () => void;
  onDelete: () => void;
  onSelectAll: () => void;
  onDeselectAll: () => void;
}

// Pagination
export interface PaginationProps {
  currentPage: number;
  pageSize: number;
  totalCount: number;
  onPageChange: (page: number) => void;
  onPageSizeChange: (size: number) => void;
}

// ============================================
// 名刺関連 Props
// ============================================

// CardForm
export interface CardFormProps {
  initialData?: Partial<BusinessCard>;
  profiles: MyProfile[];
  tags: Tag[];
  onSubmit: (data: BusinessCard, images: File[]) => Promise<void>;
  onCancel: () => void;
  isLoading?: boolean;
}

// ImageUploader
export interface ImageUploaderProps {
  images: File[];
  onAdd: (files: File[]) => void;
  onRemove: (index: number) => void;
  onReorder: (fromIndex: number, toIndex: number) => void;
  maxImages?: number;
  disabled?: boolean;
}

// OcrProgress
export interface OcrProgressProps {
  isProcessing: boolean;
  progress: number;
  currentStep: string;
  onCancel: () => void;
}

// CardDetail
export interface CardDetailProps {
  card: BusinessCardWithRelations;
  onEdit: () => void;
  onDelete: () => void;
  onAddTag: (tagId: string) => void;
  onRemoveTag: (tagId: string) => void;
}

// DuplicateModal
export interface DuplicateModalProps {
  isOpen: boolean;
  onClose: () => void;
  card1: BusinessCard;
  card2: BusinessCard;
  onMerge: (keepId: string, deleteId: string, mergedData: Partial<BusinessCard>) => void;
  onSkip: () => void;
}

// ============================================
// 設定関連 Props
// ============================================

// SettingsForm
export interface SettingsFormProps {
  settings: UserSetting;
  onSave: (data: Partial<UserSetting>) => Promise<void>;
  onChangePassword: () => void;
  onDeleteAccount: () => void;
}

// BackupPanel
export interface BackupPanelProps {
  histories: BackupHistory[];
  onBackupJson: () => Promise<void>;
  onBackupZip: () => Promise<void>;
  onRestore: (file: File, mode: 'overwrite' | 'merge') => Promise<void>;
  isLoading?: boolean;
}

// CsvExportModal
export interface CsvExportModalProps {
  isOpen: boolean;
  onClose: () => void;
  onExport: (options: CsvExportOptions) => Promise<void>;
  totalCount: number;
  filteredCount: number;
  selectedCount: number;
}

export interface CsvExportOptions {
  target: 'all' | 'filtered' | 'selected';
  fields: CsvExportField[];
  encoding: 'utf-8' | 'shift-jis';
}

export type CsvExportField =
  | 'basic'
  | 'contact'
  | 'classification'
  | 'exchange'
  | 'tags'
  | 'memo';

// ============================================
// 所属・タグ関連 Props
// ============================================

// ProfileList
export interface ProfileListProps {
  profiles: MyProfile[];
  onEdit: (id: string) => void;
  onDelete: (id: string) => void;
  onReorder: (profileIds: string[]) => void;
}

// ProfileFormModal
export interface ProfileFormModalProps {
  isOpen: boolean;
  onClose: () => void;
  onSubmit: (data: Partial<MyProfile>, image?: File) => Promise<void>;
  initialData?: MyProfile;
  isLoading?: boolean;
}

// ProfileDeleteModal
export interface ProfileDeleteModalProps {
  isOpen: boolean;
  onClose: () => void;
  profile: MyProfile;
  otherProfiles: MyProfile[];
  cardCount: number;
  onDelete: (action: 'deleteCards' | 'moveCards', targetId?: string) => Promise<void>;
  isLoading?: boolean;
}

// TagList
export interface TagListProps {
  tags: TagWithStats[];
  onEdit: (id: string) => void;
  onDelete: (id: string) => void;
}

// TagFormModal
export interface TagFormModalProps {
  isOpen: boolean;
  onClose: () => void;
  onSubmit: (data: { name: string; color?: string }) => Promise<void>;
  initialData?: Tag;
  isLoading?: boolean;
}
```

---

## 7. 実装フェーズ

### Phase 1: 基盤構築（目安: 2-3日）

| タスク | 詳細 |
|--------|------|
| 1-1 | プロジェクト初期化（Vite + React + TypeScript） |
| 1-2 | Tailwind CSS設定 |
| 1-3 | ディレクトリ構成作成 |
| 1-4 | 型定義ファイル作成（types/） |
| 1-5 | 定数ファイル作成（constants/） |
| 1-6 | Dexie.js設定・テーブル定義（services/db/） |
| 1-7 | ユーティリティ関数作成（utils/） |

**Phase 1完了条件:**
- `npm run dev` でエラーなく起動
- Dexieでデータの読み書きができる

### Phase 2: 認証機能（目安: 2日）

| タスク | 詳細 |
|--------|------|
| 2-1 | authService実装（登録、ログイン、ログアウト） |
| 2-2 | sessionService実装（セッション管理） |
| 2-3 | authStore実装 |
| 2-4 | LoginPage, RegisterPage実装 |
| 2-5 | AuthLayout実装 |
| 2-6 | ルーティング設定（認証ガード含む） |
| 2-7 | セッションタイムアウト警告実装 |

**Phase 2完了条件:**
- ユーザー登録・ログイン・ログアウトができる
- 認証状態に応じた画面遷移ができる

### Phase 3: 基本CRUD（目安: 3-4日）

| タスク | 詳細 |
|--------|------|
| 3-1 | profileService実装 |
| 3-2 | profileStore実装 |
| 3-3 | cardService実装（基本CRUD） |
| 3-4 | cardStore実装 |
| 3-5 | tagService実装 |
| 3-6 | tagStore実装 |
| 3-7 | MainLayout実装（Header, Sidebar） |
| 3-8 | DashboardPage実装（名刺一覧表示） |
| 3-9 | CardDetailPage実装 |
| 3-10 | ProfileManagePage実装 |
| 3-11 | TagManagePage実装 |

**Phase 3完了条件:**
- 所属の登録・編集・削除ができる
- 名刺の手動登録・編集・削除ができる
- タグの管理ができる
- 名刺一覧が表示される

### Phase 4: 検索・フィルター・ソート（目安: 2日）

| タスク | 詳細 |
|--------|------|
| 4-1 | FilterBar実装 |
| 4-2 | フィルター機能実装（cardService拡張） |
| 4-3 | ソート機能実装 |
| 4-4 | ページネーション実装 |
| 4-5 | 仮想スクロール実装（react-window） |
| 4-6 | 検索バー実装（デバウンス付き） |

**Phase 4完了条件:**
- 各種フィルターで絞り込みができる
- ソートができる
- 1000件でもスムーズに表示される

### Phase 5: 一括操作・エクスポート（目安: 1-2日）

| タスク | 詳細 |
|--------|------|
| 5-1 | BulkActionBar実装 |
| 5-2 | 一括選択・タグ付け実装 |
| 5-3 | 一括削除実装 |
| 5-4 | CSV出力機能実装 |
| 5-5 | CsvExportModal実装 |

**Phase 5完了条件:**
- 複数名刺を選択して一括操作できる
- CSVエクスポートができる

### Phase 6: AIスキル実装（目安: 4-5日）

| タスク | 詳細 |
|--------|------|
| 6-1 | imagePreprocessSkill実装（SK-008） |
| 6-2 | ocrSkill実装（SK-001）- Cloud Vision + Tesseract |
| 6-3 | structureSkill実装（SK-002）- Claude API |
| 6-4 | Skill Orchestrator実装 |
| 6-5 | CardCreatePage実装（OCR付き名刺登録） |
| 6-6 | OcrProgress実装 |
| 6-7 | companySkill実装（SK-005） |
| 6-8 | tagSuggestionSkill実装（SK-006） |
| 6-9 | prioritySkill実装（SK-007） |

**Phase 6完了条件:**
- 名刺画像からOCR→構造化→登録ができる
- フォールバック（ローカルOCR）が動作する

### Phase 7: 重複検出・統合（目安: 2日）

| タスク | 詳細 |
|--------|------|
| 7-1 | duplicateSkill実装（SK-003） |
| 7-2 | DuplicateCheckPage実装 |
| 7-3 | DuplicateModal, CardComparison実装 |
| 7-4 | 名刺統合機能実装 |

**Phase 7完了条件:**
- 重複候補が検出される
- 2つの名刺を比較・統合できる

### Phase 8: 設定・バックアップ（目安: 2日）

| タスク | 詳細 |
|--------|------|
| 8-1 | settingsService実装 |
| 8-2 | settingsStore実装 |
| 8-3 | SettingsPage実装 |
| 8-4 | パスワード変更機能実装 |
| 8-5 | backupService実装（JSON/ZIP） |
| 8-6 | restoreService実装 |
| 8-7 | BackupPage実装 |
| 8-8 | アカウント削除機能実装 |

**Phase 8完了条件:**
- 各種設定が保存・反映される
- バックアップ・復元ができる

### Phase 9: 自然言語検索（目安: 1-2日）

| タスク | 詳細 |
|--------|------|
| 9-1 | searchSkill実装（SK-004） |
| 9-2 | 検索バーに自然言語検索を統合 |

**Phase 9完了条件:**
- 「先月会ったIT企業の人」などで検索できる

### Phase 10: 仕上げ（目安: 2-3日）

| タスク | 詳細 |
|--------|------|
| 10-1 | ダークテーマ対応 |
| 10-2 | レスポンシブ対応 |
| 10-3 | エラーハンドリング強化 |
| 10-4 | ローディング表示の統一 |
| 10-5 | トースト通知の統一 |
| 10-6 | アクセシビリティ改善 |
| 10-7 | パフォーマンス最適化 |
| 10-8 | テスト作成 |

---

## 8. 命名規則・コーディング規約

### 8.1 ファイル命名

| 種類 | 規則 | 例 |
|------|------|-----|
| コンポーネント | PascalCase | `CardList.tsx` |
| フック | camelCase (use prefix) | `useCards.ts` |
| ストア | camelCase (Store suffix) | `cardStore.ts` |
| サービス | camelCase (Service suffix) | `cardService.ts` |
| 型定義 | camelCase | `models.ts` |
| 定数 | camelCase | `masters.ts` |
| ユーティリティ | camelCase | `format.ts` |

### 8.2 変数・関数命名

```typescript
// 変数: camelCase
const userName = 'John';
const isLoading = false;

// 定数: UPPER_SNAKE_CASE
const MAX_FILE_SIZE = 5 * 1024 * 1024;
const API_ENDPOINT = 'https://api.example.com';

// 関数: camelCase（動詞始まり）
const fetchCards = async () => {};
const calculateTotal = (items: Item[]) => {};
const isValidEmail = (email: string) => {};

// イベントハンドラ: handle prefix
const handleSubmit = () => {};
const handleCardClick = (id: string) => {};

// 型: PascalCase
interface BusinessCard {}
type Priority = 1 | 2 | 3 | 4 | 5;

// Enum値: UPPER_SNAKE_CASE
enum ErrorCode {
  AUTH_FAILED = 'AUTH_FAILED',
  NOT_FOUND = 'NOT_FOUND',
}
```

### 8.3 コンポーネント構造

```typescript
// components/card/CardList/CardList.tsx

import { useState, useCallback } from 'react';
import type { CardListProps } from '@types/components';
import { CardListItem } from './CardListItem';
import { CardListHeader } from './CardListHeader';

export const CardList = ({
  cards,
  selectedIds,
  onSelect,
  onCardClick,
  sortConfig,
  onSort,
  isLoading = false,
}: CardListProps) => {
  // 1. State
  const [hoveredId, setHoveredId] = useState<string | null>(null);

  // 2. Handlers
  const handleRowClick = useCallback((id: string) => {
    onCardClick(id);
  }, [onCardClick]);

  // 3. Early returns
  if (isLoading) {
    return <div>Loading...</div>;
  }

  if (cards.length === 0) {
    return <div>名刺がありません</div>;
  }

  // 4. Render
  return (
    <div className="card-list">
      <CardListHeader sortConfig={sortConfig} onSort={onSort} />
      <div className="card-list__body">
        {cards.map((card) => (
          <CardListItem
            key={card.id}
            card={card}
            isSelected={selectedIds.has(card.id)}
            isHovered={hoveredId === card.id}
            onSelect={() => onSelect(card.id)}
            onClick={() => handleRowClick(card.id)}
            onMouseEnter={() => setHoveredId(card.id)}
            onMouseLeave={() => setHoveredId(null)}
          />
        ))}
      </div>
    </div>
  );
};
```

### 8.4 インポート順序

```typescript
// 1. React
import { useState, useEffect, useCallback } from 'react';

// 2. 外部ライブラリ
import { useNavigate } from 'react-router-dom';
import clsx from 'clsx';

// 3. 内部モジュール（絶対パス）
import { useCardStore } from '@stores/cardStore';
import { cardService } from '@services/db/cardService';
import type { BusinessCard } from '@types/models';
import { formatDate } from '@utils/format';
import { ROUTES } from '@constants/routes';

// 4. 相対パス
import { CardListItem } from './CardListItem';
import './CardList.css';
```

### 8.5 エラーハンドリングパターン

```typescript
// サービス層
export const cardService = {
  async getById(id: string): Promise<BusinessCard> {
    const card = await db.businessCards.get(id);
    if (!card) {
      throw new Error(`Card not found: ${id}`);
    }
    return card;
  },
};

// ストア層
const fetchCardById = async (id: string) => {
  set({ isLoading: true, error: null });
  try {
    const card = await cardService.getById(id);
    set({ currentCard: card, isLoading: false });
  } catch (error) {
    set({ 
      error: error instanceof Error ? error.message : '不明なエラー',
      isLoading: false 
    });
  }
};

// コンポーネント層
const handleDelete = async () => {
  try {
    await deleteCard(id);
    addToast({ type: 'success', message: '名刺を削除しました' });
    navigate(ROUTES.DASHBOARD);
  } catch (error) {
    addToast({ 
      type: 'error', 
      message: error instanceof Error ? error.message : '削除に失敗しました' 
    });
  }
};
```

---

## 改訂履歴

| Ver | 日付 | 内容 |
|-----|------|------|
| 1.0 | 2025/01/17 | 初版作成 |
