# 名刺管理アプリ 設計書

**作成日:** 2025年1月17日  
**バージョン:** 3.0  
**最終更新日:** 2026年1月18日

---

## 目次

1. [画面設計](#1-画面設計)
2. [データベース設計](#2-データベース設計)
3. [機能設計](#3-機能設計)
4. [技術仕様](#4-技術仕様)
5. [改訂履歴](#5-改訂履歴)

---

## 1. 画面設計

### 1.1 全体構成

本アプリケーションは、ログイン後にダッシュボードを中心として各機能にアクセスする構成とする。

#### 1.1.1 画面遷移図

| 遷移元 | 操作 | 遷移先 |
|--------|------|--------|
| ログイン画面 | ログイン成功 | ダッシュボード |
| ログイン画面 | 新規登録リンク | ユーザー登録画面 |
| ダッシュボード | 名刺行クリック | 名刺詳細画面 |
| ダッシュボード | 新規登録ボタン | 名刺登録画面 |
| ダッシュボード | 所属クリック | 所属管理画面 |
| ダッシュボード | 設定アイコン | 設定画面 |
| 名刺詳細画面 | 戻る | ダッシュボード |
| 設定画面 | バックアップ | バックアップ画面 |
| 設定画面 | CSVエクスポート | CSVエクスポート画面 |

---

### 1.2 ダッシュボード（メイン画面）

ログイン後に表示されるメイン画面。Eightの画面構成を参考に、左右2ペイン構成とする。

#### 1.2.1 レイアウト概要

```
┌─────────────────────────────────────────────────────────────────┐
│ 【ヘッダー】                                                      │
│ ロゴ | [検索バー                    ] | +新規登録 | ⚙ | 👤        │
├─────────────────────────────────────────────────────────────────┤
│ 【フィルターエリア】                                               │
│ 交換日 [▼] | 業種 [▼] | エリア [▼] | 役職 [▼] | タグ [▼]         │
├───────────────┬─────────────────────────────────────────────────┤
│ 左サイド(25%) │ 右メイン(75%)                                     │
│               │                                                   │
│ ◆ 所属一覧    │ ◆ 名刺リストビュー                                │
│               │                                                   │
│ ┌───────────┐│ ┌──┬────┬──────────┬────────┬──────┬────┬────┐ │
│ │ すべての  ││ │□ │画像│氏名/会社  │部署/役職│メール │交換日│タグ│ │
│ │ 名刺 (493)││ ├──┼────┼──────────┼────────┼──────┼────┼────┤ │
│ └───────────┘│ │□ │ 📇 │山田太郎   │営業部   │xxx@  │01/15│ 2 │ │
│ ┌───────────┐│ │  │    │株式会社○○│部長    │      │     │    │ │
│ │ A社       ││ ├──┼────┼──────────┼────────┼──────┼────┼────┤ │
│ │ 代表(150) ││ │□ │ 📇 │佐藤花子   │開発部   │yyy@  │01/14│ 1 │ │
│ └───────────┘│ │  │    │△△株式会社│課長    │      │     │    │ │
│ ┌───────────┐│ └──┴────┴──────────┴────────┴──────┴────┴────┘ │
│ │ B社       ││                                                   │
│ │ 顧問(343) ││ （カラムヘッダーでソート可能）                      │
│ └───────────┘│                                                   │
│               │ ─────────────────────────────────────────────── │
│ ─────────────│ 表示: [50件▼] | 1-50 / 493件 | [<][1][2]...[>]   │
│ [+ 所属追加]  │                                                   │
└───────────────┴─────────────────────────────────────────────────┘
```

#### 1.2.2 ヘッダー詳細

| 要素 | 配置 | 説明 |
|------|------|------|
| ロゴ | 左端 | アプリロゴ。クリックでダッシュボードに戻る |
| 検索バー | 中央 | フリーワード検索。氏名、会社名、メールアドレスで検索 |
| 新規登録ボタン | 右寄り | 名刺登録画面へ遷移 |
| 設定アイコン | 右端 | 設定画面へ遷移 |
| ユーザーアイコン | 右端 | クリックでログアウトメニュー表示 |

#### 1.2.3 フィルターエリア詳細

| フィルター | UI | 選択肢 |
|------------|-------|--------|
| 交換日 | ドロップダウン＋日付選択 | 指定なし/今週/今月/期間指定 |
| 業種 | ドロップダウン＋複数選択 | IT・通信/金融・保険/製造業/小売・卸売/サービス業/建設・不動産/医療・福祉/教育・研究/官公庁・団体/その他 |
| エリア | ドロップダウン＋複数選択 | 北海道〜沖縄（都道府県47区分）/海外 |
| 役職 | ドロップダウン＋複数選択 | 経営者/役員/部長級/課長級/担当者/その他 |
| タグ | ドロップダウン＋複数選択 | ユーザー作成タグ一覧 |

#### 1.2.4 左サイドパネル詳細

自分の所属（顔）を縦に一覧表示。各所属には名刺画像のサムネイルを表示。

| 要素 | 説明 |
|------|------|
| すべての名刺 | 全名刺を表示。名刺数をカッコ内に表示 |
| 所属カード | 名刺画像（サムネイル）、会社名、肩書き、名刺数を表示 |
| 選択状態 | クリックで選択。選択中は背景色変更とチェックマーク表示 |
| フィルター連動 | 所属選択時、右側リストをその所属の名刺のみに絞り込み |
| 追加ボタン | 「＋所属追加」ボタンで所属管理画面へ遷移 |

#### 1.2.5 名刺リストビュー詳細

登録済み名刺を一覧表示するメインエリア。

##### カラム構成

| カラム | 幅目安 | 内容 | ソート |
|--------|--------|------|--------|
| チェックボックス | 5% | 一括操作用の選択 | − |
| 名刺画像 | 8% | サムネイル表示 | − |
| 氏名/会社名 | 22% | 氏名（大）、会社名（小）を2行表示 | ○ |
| 部署/役職 | 18% | 部署名、役職を表示 | ○ |
| 電話/メール | 22% | 電話番号、メールアドレス | − |
| 交換日 | 10% | YYYY/MM/DD形式 | ○（デフォルト） |
| 優先度 | 8% | ★アイコンで表示 | ○ |
| タグ | 4% | タグ数をアイコンで表示 | − |
| メモ | 3% | メモ有無をアイコンで表示 | − |

##### ソート機能

- カラムヘッダーをクリックで昇順ソート
- 再クリックで降順に切り替え
- ソート中カラムには▲（昇順）/▼（降順）アイコンを表示
- デフォルト：交換日の降順（新しい順）

##### 行操作

- 行クリック：名刺詳細画面へ遷移
- チェックボックス：一括操作の対象として選択
- ホバー時：背景色を薄く変更

##### ページネーション

| 要素 | 説明 |
|------|------|
| 表示件数選択 | 25件/50件/100件から選択（デフォルト：50件） |
| 件数表示 | 「1-50 / 493件」形式で表示 |
| ページ移動 | [<] [1] [2] [3] ... [10] [>] |

##### 一括操作バー

1件以上選択時、リスト上部に一括操作バーを表示。

```
┌─────────────────────────────────────────────────────────────────┐
│ ☑ 3件選択中 | [タグ付け] [エクスポート] [削除] | [全選択] [解除] │
└─────────────────────────────────────────────────────────────────┘
```

---

### 1.3 名刺詳細画面

個別の名刺情報を表示・編集する画面。

#### 1.3.1 レイアウト概要

```
┌─────────────────────────────────────────────────────────────────┐
│ 【ヘッダー】                                                      │
│ ← 戻る          名刺詳細              [編集] [削除]               │
├─────────────────────────────┬───────────────────────────────────┤
│ 左：名刺画像 (40%)          │ 右：詳細情報 (60%)                 │
│                             │                                   │
│ ┌─────────────────────────┐│ 氏名：山田 太郎                   │
│ │                         ││ ふりがな：やまだ たろう            │
│ │       名刺画像          ││                                   │
│ │       （表面）          ││ 会社名：株式会社○○                │
│ │                         ││ 部署：営業部                      │
│ └─────────────────────────┘│ 役職：部長                        │
│ ┌─────────────────────────┐│ 業種：IT・通信                    │
│ │       名刺画像          ││ エリア：東京都                    │
│ │       （裏面）          ││                                   │
│ └─────────────────────────┘│ メール：yamada@example.com        │
│                             │ 電話：03-XXXX-XXXX                │
│ [🔍 拡大表示] [+ 画像追加]  │ 携帯：090-XXXX-XXXX               │
│                             │ 住所：東京都...                   │
│                             │ Web：https://example.com          │
│                             │                                   │
│                             │ ───────────────────────────────  │
│                             │                                   │
│                             │ 交換日：2025/01/15                │
│                             │ 交換した所属：A社の名刺            │
│                             │ 出会った場所：○○展示会            │
│                             │                                   │
│                             │ 優先度：★★★★☆                   │
│                             │ タグ：[展示会] [IT業界] [+追加]    │
│                             │                                   │
│                             │ メモ：                            │
│                             │ ○○さんの紹介で名刺交換。          │
│                             │ クラウドサービスに興味あり。       │
└─────────────────────────────┴───────────────────────────────────┘
```

#### 1.3.2 画像拡大表示モーダル

```
┌─────────────────────────────────────────────────────────────────┐
│                                                         [×]     │
│                                                                 │
│                                                                 │
│                     【名刺画像（実寸拡大）】                       │
│                                                                 │
│                                                                 │
│                                                                 │
├─────────────────────────────────────────────────────────────────┤
│        [◀ 前へ]    表面 (1/2)    [次へ ▶]                        │
└─────────────────────────────────────────────────────────────────┘
```

---

### 1.4 名刺登録画面

名刺を撮影/アップロードし、OCR読取後に情報を確認・編集して登録する画面。1画面で完結する構成とする。

#### 1.4.1 レイアウト概要

```
┌─────────────────────────────────────────────────────────────────┐
│ 名刺登録                                                  [×]   │
├─────────────────────────────────────────────────────────────────┤
│ ┌─────────────────┐  基本情報                                   │
│ │                 │  ────────                                   │
│ │   名刺画像      │  氏名*       [                ] ✓ OCR      │
│ │   (表面)        │  ふりがな    [                ]             │
│ │                 │  会社名*     [                ] ✓ OCR      │
│ │ [📷撮影][📁選択]│  部署        [                ] ✓ OCR      │
│ └─────────────────┘  役職        [                ] ✓ OCR      │
│ ┌─────────────────┐  メール      [                ] ✓ OCR      │
│ │   名刺画像      │  電話        [                ] ✓ OCR      │
│ │   (裏面)        │  携帯        [                ]             │
│ │   任意         │  住所        [                ]             │
│ │ [+ 裏面追加]    │  Web         [                ]             │
│ └─────────────────┘  業種        [            ▼]               │
│                      エリア      [            ▼]               │
│                      役職レベル  [            ▼]               │
│                      ─────────────────────────────             │
│                      交換情報                                   │
│                      ────────                                   │
│                      交換した所属* [            ▼]              │
│                      交換日        [2025/01/17  📅]             │
│                      出会った場所  [                ]            │
│                      優先度        [★★★☆☆]                    │
│                      タグ          [      ][+追加]              │
│                      メモ          [                         ]  │
│                                    [                         ]  │
├─────────────────────────────────────────────────────────────────┤
│                              [キャンセル]  [登録する]            │
└─────────────────────────────────────────────────────────────────┘
```

#### 1.4.2 OCR処理中の表示

```
┌─────────────────────────────────────────┐
│                                         │
│     [名刺画像プレビュー]                 │
│                                         │
│     ━━━━━━━━━━━━━━━━━━  Gemini 1.5 Pro │
│     読み取り中...                        │
│                                         │
│     ✓ 画像を解析しています               │
│     ● 文字を認識しています ← 現在        │
│     ○ 情報を整理しています               │
│                                         │
│              [キャンセル]                │
└─────────────────────────────────────────┘
```

#### 1.4.3 入力項目

| 項目 | 入力方式 | 必須 | 説明 |
|------|----------|------|------|
| 名刺画像（表面） | カメラ/ファイル | ○ | 名刺の表面画像 |
| 名刺画像（裏面） | カメラ/ファイル | − | 名刺の裏面画像 |
| 氏名 | テキスト（OCR） | ○ | 相手の氏名 |
| ふりがな | テキスト | − | 氏名のふりがな |
| 会社名 | テキスト（OCR） | ○ | 相手の会社名 |
| 部署 | テキスト（OCR） | − | 部署名 |
| 役職 | テキスト（OCR） | − | 役職名 |
| メールアドレス | テキスト（OCR） | − | メールアドレス |
| 電話番号 | テキスト（OCR） | − | 電話番号 |
| 携帯番号 | テキスト | − | 携帯電話番号 |
| 住所 | テキスト | − | 住所 |
| Webサイト | テキスト | − | WebサイトURL |
| 業種 | ドロップダウン | − | 業種マスタから選択 |
| エリア | ドロップダウン | − | 都道府県マスタから選択 |
| 役職レベル | ドロップダウン | − | 役職レベルマスタから選択 |
| 交換した所属 | ドロップダウン | ○ | 自分のどの所属で交換したか |
| 交換日 | 日付選択 | − | 名刺交換した日付（デフォルト：今日） |
| 出会った場所 | テキスト | − | 展示会名、イベント名など |
| 優先度 | 5段階選択 | − | デフォルト：ユーザー設定値（初期★★★） |
| タグ | 複数選択 | − | 既存タグから選択、または新規作成 |
| メモ | テキストエリア | − | 自由記述欄 |

---

### 1.5 設定画面

#### 1.5.1 レイアウト概要

```
┌─────────────────────────────────────────────────────────────────┐
│ ← 戻る              設定                                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│ アカウント                                                      │
│ ─────────────────────────────────────────────────────────────  │
│ メールアドレス    example@mail.com                              │
│ パスワード        ********                        [変更]        │
│                                                                 │
│ 表示設定                                                        │
│ ─────────────────────────────────────────────────────────────  │
│ 一覧の表示件数    [50件 ▼]                                      │
│ デフォルト優先度  [★★★☆☆]                                      │
│ テーマ            ○ ライト  ● ダーク                           │
│                                                                 │
│ セキュリティ                                                    │
│ ─────────────────────────────────────────────────────────────  │
│ 自動ログアウト    [30分 ▼]    （15分/30分/60分/無制限）          │
│                                                                 │
│ OCR設定                                                         │
│ ─────────────────────────────────────────────────────────────  │
│ 認識言語          ☑ 日本語  ☑ 英語  ☐ 中国語  ☐ 韓国語        │
│                                                                 │
│ データ管理                                                      │
│ ─────────────────────────────────────────────────────────────  │
│ [バックアップ]  [データ復元]  [CSVエクスポート]                  │
│                                                                 │
│ ─────────────────────────────────────────────────────────────  │
│ [アカウントを削除する]                                           │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

#### 1.5.2 パスワード変更モーダル

```
┌─────────────────────────────────────────┐
│ パスワード変更                    [×]   │
├─────────────────────────────────────────┤
│                                         │
│ 現在のパスワード                         │
│ [                              ]        │
│                                         │
│ 新しいパスワード                         │
│ [                              ]        │
│ ・8文字以上                             │
│ ・英字大文字を含む ✓                    │
│ ・英字小文字を含む ✓                    │
│ ・数字を含む ✗                          │
│                                         │
│ 新しいパスワード（確認）                 │
│ [                              ]        │
│                                         │
│        [キャンセル]  [変更する]          │
└─────────────────────────────────────────┘
```

#### 1.5.3 アカウント削除確認モーダル

```
┌─────────────────────────────────────────┐
│ ⚠ アカウント削除                  [×]   │
├─────────────────────────────────────────┤
│                                         │
│ アカウントを削除すると、以下のデータが   │
│ すべて削除されます。この操作は取り消せ   │
│ ません。                                │
│                                         │
│ ・登録済みの名刺（493件）               │
│ ・自分の所属情報（2件）                 │
│ ・タグ（15件）                          │
│ ・すべての設定                          │
│                                         │
│ 確認のため、パスワードを入力してください │
│ [                              ]        │
│                                         │
│        [キャンセル]  [削除する]          │
└─────────────────────────────────────────┘
```

---

### 1.6 CSVエクスポート画面

```
┌─────────────────────────────────────────┐
│ CSVエクスポート                   [×]   │
├─────────────────────────────────────────┤
│                                         │
│ 出力対象                                 │
│ ─────────────────────────────────────  │
│ ○ すべての名刺 (493件)                  │
│ ○ 現在の絞り込み結果 (25件)             │
│ ○ 選択した名刺 (3件)                    │
│                                         │
│ 出力項目                                 │
│ ─────────────────────────────────────  │
│ ☑ 基本情報（氏名、会社名、部署、役職）  │
│ ☑ 連絡先（メール、電話、住所）          │
│ ☑ 分類情報（業種、エリア、役職レベル）  │
│ ☑ 交換情報（日付、場所、所属）          │
│ ☑ タグ・優先度                          │
│ ☐ メモ                                  │
│                                         │
│ 文字コード                               │
│ ─────────────────────────────────────  │
│ ○ UTF-8（推奨）                         │
│ ○ Shift-JIS（Excel用）                  │
│                                         │
│        [キャンセル]  [エクスポート]       │
└─────────────────────────────────────────┘
```

---

### 1.7 所属管理画面

#### 1.7.1 レイアウト概要

```
┌─────────────────────────────────────────────────────────────────┐
│ ← 戻る            所属管理               [+ 新規追加]            │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│ ┌─────────────────────────────────────────────────────────────┐│
│ │ ≡  [名刺画像]  A社                                          ││
│ │              代表取締役                                      ││
│ │              example@a-company.com                          ││
│ │              名刺: 150件                    [編集] [削除]    ││
│ └─────────────────────────────────────────────────────────────┘│
│                                                                 │
│ ┌─────────────────────────────────────────────────────────────┐│
│ │ ≡  [名刺画像]  B社                                          ││
│ │              顧問                                            ││
│ │              advisor@b-corp.co.jp                           ││
│ │              名刺: 343件                    [編集] [削除]    ││
│ └─────────────────────────────────────────────────────────────┘│
│                                                                 │
│ ※ ≡ をドラッグして表示順を変更できます                          │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

#### 1.7.2 所属削除確認モーダル

```
┌─────────────────────────────────────────┐
│ 所属を削除しますか？              [×]   │
├─────────────────────────────────────────┤
│                                         │
│ 「A社 代表取締役」には 150件の名刺が    │
│ 紐付いています。                        │
│                                         │
│ ○ 名刺も一緒に削除する                  │
│                                         │
│ ○ 名刺を別の所属に移動する              │
│   移動先: [B社 顧問            ▼]       │
│                                         │
│        [キャンセル]  [削除する]          │
└─────────────────────────────────────────┘
```

---

### 1.8 バックアップ画面

```
┌─────────────────────────────────────────────────────────────────┐
│ ← 戻る            バックアップ・復元                             │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│ バックアップ作成                                                 │
│ ─────────────────────────────────────────────────────────────  │
│ 登録データ（画像含む）をJSON形式でローカルに保存します。          │
│ ※画像はBase64形式でJSONに含まれます（ファイルサイズ大に注意）。  │
│                                                                 │
│ [データをバックアップ（JSON）]                                   │
│                                                                 │
│ ─────────────────────────────────────────────────────────────  │
│                                                                 │
│ データ復元                                                       │
│ ─────────────────────────────────────────────────────────────  │
│ バックアップファイル（JSON）からデータを復元します。              │
│                                                                 │
│ [データを復元（インポート）]  未選択                             │
│                                                                 │
│ 復元方法:                                                        │
│ ○ 上書き（既存データを削除して復元）                             │
│ ○ マージ（既存データに追加）                                     │
│                                                                 │
│                                    [復元プレビュー]              │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

### 1.9 セッションタイムアウト警告モーダル

```
┌─────────────────────────────────────────┐
│ セッション有効期限                       │
├─────────────────────────────────────────┤
│                                         │
│ セッションがまもなく切れます。           │
│                                         │
│ 残り時間: 4:32                          │
│                                         │
│ このまま操作がない場合、自動的に         │
│ ログアウトされます。                     │
│                                         │
│   [ログアウト]    [セッションを延長]     │
└─────────────────────────────────────────┘
```

---

### 1.10 エラー表示パターン

#### 1.10.1 インラインエラー（フォームバリデーション）

```
メールアドレス*
[invalid-email          ]
⚠ 有効なメールアドレスを入力してください
```

#### 1.10.2 トースト通知（操作結果）

```
┌──────────────────────────────────────┐
│ ✓ 名刺を登録しました                  │  ← 成功（緑）
└──────────────────────────────────────┘

┌──────────────────────────────────────┐
│ ⚠ バックアップの作成に失敗しました    │  ← エラー（赤）
│                        [再試行]      │
└──────────────────────────────────────┘
```

#### 1.10.3 OCRエラー表示

```
┌─────────────────────────────────────────┐
│                                         │
│     [名刺画像プレビュー]                 │
│                                         │
│     ⚠ 文字を読み取れませんでした         │
│                                         │
│     画像が不鮮明な可能性があります。      │
│     手動で入力するか、別の画像を         │
│     お試しください。                     │
│                                         │
│     [別の画像を選択]  [手動で入力]       │
└─────────────────────────────────────────┘
```

---

### 1.11 その他の画面

#### 1.11.1 ログイン画面

- メールアドレス入力欄
- パスワード入力欄（パスワード表示トグル付き）
- ログインボタン
- 新規登録リンク
- パスワードを忘れた方リンク（Phase2）

#### 1.11.2 ユーザー登録画面

- メールアドレス入力欄
- パスワード入力欄（要件チェック表示付き）
- パスワード確認入力欄
- 登録ボタン
- ログインリンク

#### 1.11.3 タグ管理画面

- タグ一覧（名刺数付き）
- 新規タグ作成（名前、色選択）
- タグ名・色編集
- タグ削除（確認ダイアログ）

#### 1.11.4 重複確認画面

- 重複候補ペアを一覧表示
- 2つの名刺を並べて比較表示
- 統合ボタン（どちらの情報を優先するか選択）
- スキップボタン（重複ではない場合）

---

## 2. データベース設計

ブラウザのIndexedDBを使用したローカルストレージ設計。

### 2.1 ER図

```
                              ┌──────────────┐
                              │    User      │
                              └──────┬───────┘
                                     │1
                 ┌───────────────────┼───────────────────┐
                 │                   │                   │
                 │n                  │1                  │n
          ┌──────┴───────┐    ┌──────┴───────┐    ┌──────┴───────┐
          │  MyProfile   │    │  UserSetting │    │   Session    │
          └──────┬───────┘    └──────────────┘    └──────────────┘
                 │1
                 │
                 │n
          ┌──────┴───────┐         ┌─────────┐
          │ BusinessCard │         │   Tag   │
          └──────┬───────┘         └────┬────┘
                 │1                      │1
       ┌─────────┼─────────┐            │
       │n        │n        │n           │n
┌──────┴───────┐ │  ┌──────┴──────┐ ┌───┴─────┐
│BusinessCard  │ │  │DuplicateSkip│ │ CardTag │
│    Image     │ │  └─────────────┘ └─────────┘
└──────────────┘ │                       │n
                 │                       │
                 └───────────────────────┘
                        (cardId)

          ┌──────────────┐
          │BackupHistory │  ← Userに1:nで紐付く
          └──────────────┘
```

---

### 2.2 テーブル定義

#### 2.2.1 User（ユーザー）

| カラム名 | 型 | PK | 必須 | 説明 |
|----------|----|----|------|------|
| id | string (UUID) | ○ | ○ | 一意識別子 |
| email | string | − | ○ | メールアドレス（ログインID） |
| passwordHash | string | − | ○ | bcryptjsハッシュ化パスワード |
| createdAt | datetime | − | ○ | 作成日時 |
| updatedAt | datetime | − | ○ | 更新日時 |
| lastLoginAt | datetime | − | − | 最終ログイン日時 |

#### 2.2.2 Session（セッション）

| カラム名 | 型 | PK | 必須 | 説明 |
|----------|----|----|------|------|
| id | string (UUID) | ○ | ○ | セッションID |
| userId | string | − | ○ | ユーザーID（FK） |
| token | string | − | ○ | 認証トークン |
| expiresAt | datetime | − | ○ | 有効期限 |
| createdAt | datetime | − | ○ | 作成日時 |

#### 2.2.3 UserSetting（ユーザー設定）

| カラム名 | 型 | PK | 必須 | デフォルト | 説明 |
|----------|----|----|------|------|------|
| id | string (UUID) | ○ | ○ | − | 一意識別子 |
| userId | string | − | ○ | − | ユーザーID（FK） |
| sessionTimeout | number | − | ○ | 30 | セッションタイムアウト（分） |
| defaultPriority | number | − | ○ | 3 | 新規名刺のデフォルト優先度（1-5） |
| listPageSize | number | − | ○ | 50 | 一覧のページサイズ |
| theme | string | − | ○ | 'light' | テーマ（'light' / 'dark'） |
| ocrLanguages | string | − | ○ | 'jpn+eng' | OCR言語設定（Tesseract形式） |
| cloudOcrProvider | string | − | − | 'google' | クラウドOCRプロバイダー |
| cloudOcrApiKey | string | − | − | − | クラウドOCR APIキー（暗号化保存） |
| llmProvider | string | − | − | 'anthropic' | LLMプロバイダー |
| llmApiKey | string | − | − | − | LLM APIキー（暗号化保存） |
| enableAiFeatures | boolean | − | ○ | true | AI機能の有効/無効 |
| enableCompanyLookup | boolean | − | ○ | true | 会社情報補完の有効/無効 |
| createdAt | datetime | − | ○ | − | 作成日時 |
| updatedAt | datetime | − | ○ | − | 更新日時 |

※APIキーはAES暗号化してローカル保存

#### 2.2.4 MyProfile（自分の所属）

| カラム名 | 型 | PK | 必須 | 説明 |
|----------|----|----|------|------|
| id | string (UUID) | ○ | ○ | 一意識別子 |
| userId | string | − | ○ | ユーザーID（FK） |
| companyName | string | − | ○ | 会社名 |
| position | string | − | − | 役職・肩書き |
| email | string | − | − | メールアドレス |
| phone | string | − | − | 電話番号 |
| address | string | − | − | 住所 |
| cardImage | blob | − | − | 名刺画像データ |
| displayOrder | number | − | ○ | 表示順（1から連番） |
| createdAt | datetime | − | ○ | 作成日時 |
| updatedAt | datetime | − | ○ | 更新日時 |

#### 2.2.5 BusinessCard（相手の名刺）

| カラム名 | 型 | PK | 必須 | 説明 |
|----------|----|----|------|------|
| id | string (UUID) | ○ | ○ | 一意識別子 |
| profileId | string | − | ○ | 紐付く所属ID（FK） |
| personName | string | − | ○ | 氏名 |
| personNameKana | string | − | − | 氏名（フリガナ） |
| companyName | string | − | ○ | 会社名 |
| department | string | − | − | 部署名 |
| position | string | − | − | 役職 |
| email | string | − | − | メールアドレス |
| phone | string | − | − | 電話番号 |
| mobile | string | − | − | 携帯電話番号 |
| address | string | − | − | 住所 |
| website | string | − | − | Webサイト |
| industry | string | − | − | 業種コード |
| area | string | − | − | エリア（都道府県コード） |
| positionLevel | string | − | − | 役職レベルコード |
| exchangeDate | date | − | − | 名刺交換日 |
| meetingPlace | string | − | − | 出会った場所 |
| memo | text | − | − | メモ |
| priority | number | − | ○ | 優先度（1-5） |
| createdAt | datetime | − | ○ | 作成日時 |
| updatedAt | datetime | − | ○ | 更新日時 |

#### 2.2.6 BusinessCardImage（名刺画像）

| カラム名 | 型 | PK | 必須 | 説明 |
|----------|----|----|------|------|
| id | string (UUID) | ○ | ○ | 一意識別子 |
| cardId | string | − | ○ | 名刺ID（FK） |
| imageData | blob | − | ○ | 画像データ |
| imageType | string | − | ○ | 'front' / 'back' / 'other' |
| displayOrder | number | − | ○ | 表示順（1から連番） |
| createdAt | datetime | − | ○ | 作成日時 |

#### 2.2.7 Tag（タグ）

| カラム名 | 型 | PK | 必須 | 説明 |
|----------|----|----|------|------|
| id | string (UUID) | ○ | ○ | 一意識別子 |
| userId | string | − | ○ | ユーザーID（FK） |
| name | string | − | ○ | タグ名 |
| color | string | − | − | タグ色（#RRGGBB形式） |
| createdAt | datetime | − | ○ | 作成日時 |
| updatedAt | datetime | − | ○ | 更新日時 |

#### 2.2.8 CardTag（名刺-タグ紐付け）

| カラム名 | 型 | PK | 必須 | 説明 |
|----------|----|----|------|------|
| cardId | string | ○ | ○ | 名刺ID（FK） |
| tagId | string | ○ | ○ | タグID（FK） |
| createdAt | datetime | − | ○ | 作成日時 |

※複合主キー（cardId, tagId）

#### 2.2.9 DuplicateSkip（重複スキップ）

| カラム名 | 型 | PK | 必須 | 説明 |
|----------|----|----|------|------|
| cardId1 | string | ○ | ○ | 名刺ID1（FK、小さい方） |
| cardId2 | string | ○ | ○ | 名刺ID2（FK、大きい方） |
| createdAt | datetime | − | ○ | 作成日時 |

※複合主キー（cardId1, cardId2）。cardId1 < cardId2 となるよう正規化。

#### 2.2.10 BackupHistory（バックアップ履歴）

| カラム名 | 型 | PK | 必須 | 説明 |
|----------|----|----|------|------|
| id | string (UUID) | ○ | ○ | 一意識別子 |
| userId | string | − | ○ | ユーザーID（FK） |
| backupType | string | − | ○ | 'json' / 'zip' |
| schemaVersion | string | − | ○ | スキーマバージョン（例：'2.0.0'） |
| cardCount | number | − | ○ | バックアップ時の名刺数 |
| fileSize | number | − | ○ | ファイルサイズ（bytes） |
| createdAt | datetime | − | ○ | バックアップ日時 |

---

### 2.3 インデックス

| テーブル | インデックス | 用途 |
|----------|--------------|------|
| User | email | ログイン時の検索 |
| Session | userId | ユーザーのセッション取得 |
| Session | token | トークン検証 |
| Session | expiresAt | 期限切れセッション削除 |
| UserSetting | userId | ユーザー設定取得 |
| MyProfile | userId | ユーザーの所属一覧取得 |
| MyProfile | userId, displayOrder | 所属の順序付き取得 |
| BusinessCard | profileId | 所属別名刺一覧取得 |
| BusinessCard | personName | 氏名検索・ソート |
| BusinessCard | companyName | 会社名検索・ソート |
| BusinessCard | email | 重複検出 |
| BusinessCard | exchangeDate | 交換日ソート・フィルター |
| BusinessCard | priority | 優先度ソート |
| BusinessCard | industry | 業種フィルター |
| BusinessCard | area | エリアフィルター |
| BusinessCard | positionLevel | 役職フィルター |
| BusinessCardImage | cardId | 名刺の画像一覧取得 |
| Tag | userId | ユーザーのタグ一覧取得 |
| CardTag | cardId | 名刺のタグ一覧取得 |
| CardTag | tagId | タグの名刺一覧取得 |
| BackupHistory | userId | バックアップ履歴取得 |

---

### 2.4 マスタデータ

#### 2.4.1 業種マスタ（定数定義）

```typescript
const INDUSTRY_MASTER = {
  IT: 'IT・通信',
  FINANCE: '金融・保険',
  MANUFACTURING: '製造業',
  RETAIL: '小売・卸売',
  SERVICE: 'サービス業',
  CONSTRUCTION: '建設・不動産',
  MEDICAL: '医療・福祉',
  EDUCATION: '教育・研究',
  GOVERNMENT: '官公庁・団体',
  OTHER: 'その他'
} as const;
```

#### 2.4.2 役職レベルマスタ（定数定義）

```typescript
const POSITION_LEVEL_MASTER = {
  EXECUTIVE: '経営者',
  DIRECTOR: '役員',
  MANAGER: '部長級',
  SECTION_CHIEF: '課長級',
  STAFF: '担当者',
  OTHER: 'その他'
} as const;
```

#### 2.4.3 エリアマスタ（定数定義）

```typescript
const AREA_MASTER = {
  HOKKAIDO: '北海道',
  AOMORI: '青森県',
  // ... 他の都道府県
  OKINAWA: '沖縄県',
  OVERSEAS: '海外'
} as const;
```

---

## 3. 機能設計

### 3.1 認証機能

#### 3.1.1 パスワードハッシュ化

| 項目 | 仕様 |
|------|------|
| ライブラリ | bcryptjs |
| ソルトラウンド | 10 |
| ハッシュ形式 | $2a$10$... |

#### 3.1.2 パスワードバリデーション

```typescript
const validatePassword = (password: string): ValidationResult => {
  const errors: string[] = [];
  
  if (password.length < 8) {
    errors.push('8文字以上で入力してください');
  }
  if (!/[A-Z]/.test(password)) {
    errors.push('英字大文字を含めてください');
  }
  if (!/[a-z]/.test(password)) {
    errors.push('英字小文字を含めてください');
  }
  if (!/[0-9]/.test(password)) {
    errors.push('数字を含めてください');
  }
  
  return { isValid: errors.length === 0, errors };
};
```

#### 3.1.3 セッション管理

| 処理 | 詳細 |
|------|------|
| ログイン時 | 新規Sessionレコード作成、トークンをメモリに保持 |
| 操作時 | expiresAtを現在時刻 + タイムアウト時間に更新 |
| 警告表示 | 残り5分で警告モーダル表示 |
| ログアウト時 | Sessionレコード削除 |
| 自動クリーンアップ | アプリ起動時に期限切れSessionを削除 |

```typescript
// セッション延長処理
const extendSession = async (sessionId: string, timeoutMinutes: number) => {
  const newExpiry = new Date(Date.now() + timeoutMinutes * 60 * 1000);
  await db.sessions.update(sessionId, { expiresAt: newExpiry });
};

// タイムアウト監視
const startSessionMonitor = (sessionId: string, timeoutMinutes: number) => {
  setInterval(async () => {
    const session = await db.sessions.get(sessionId);
    if (!session) return;
    
    const remaining = session.expiresAt.getTime() - Date.now();
    
    if (remaining <= 0) {
      // 自動ログアウト
      await logout();
    } else if (remaining <= 5 * 60 * 1000) {
      // 警告表示
      showSessionWarning(remaining);
    }
  }, 30000); // 30秒ごとにチェック
};
```

---

### 3.2 削除処理

#### 3.2.1 所属削除

```typescript
const deleteProfile = async (
  profileId: string, 
  action: 'deleteCards' | 'moveCards',
  targetProfileId?: string
): Promise<void> => {
  const cards = await db.businessCards
    .where('profileId')
    .equals(profileId)
    .toArray();
  
  if (action === 'moveCards' && targetProfileId) {
    // 名刺を移動
    await db.businessCards
      .where('profileId')
      .equals(profileId)
      .modify({ profileId: targetProfileId, updatedAt: new Date() });
  } else {
    // 名刺と関連データを削除
    const cardIds = cards.map(c => c.id);
    
    // CardTag削除
    await db.cardTags.where('cardId').anyOf(cardIds).delete();
    
    // BusinessCardImage削除
    await db.businessCardImages.where('cardId').anyOf(cardIds).delete();
    
    // DuplicateSkip削除
    await db.duplicateSkips
      .filter(ds => cardIds.includes(ds.cardId1) || cardIds.includes(ds.cardId2))
      .delete();
    
    // BusinessCard削除
    await db.businessCards.where('profileId').equals(profileId).delete();
  }
  
  // 所属削除
  await db.myProfiles.delete(profileId);
  
  // 表示順を再整列
  await reorderProfiles(cards[0]?.userId);
};
```

#### 3.2.2 タグ削除

```typescript
const deleteTag = async (tagId: string): Promise<void> => {
  // CardTagから紐付けを削除
  await db.cardTags.where('tagId').equals(tagId).delete();
  
  // タグを削除
  await db.tags.delete(tagId);
};
```

#### 3.2.3 アカウント削除

```typescript
const deleteAccount = async (userId: string): Promise<void> => {
  // 関連データをすべて削除（順序重要）
  
  // 1. CardTag
  const tags = await db.tags.where('userId').equals(userId).toArray();
  const tagIds = tags.map(t => t.id);
  await db.cardTags.where('tagId').anyOf(tagIds).delete();
  
  // 2. DuplicateSkip, BusinessCardImage
  const profiles = await db.myProfiles.where('userId').equals(userId).toArray();
  const profileIds = profiles.map(p => p.id);
  const cards = await db.businessCards.where('profileId').anyOf(profileIds).toArray();
  const cardIds = cards.map(c => c.id);
  
  await db.duplicateSkips
    .filter(ds => cardIds.includes(ds.cardId1) || cardIds.includes(ds.cardId2))
    .delete();
  await db.businessCardImages.where('cardId').anyOf(cardIds).delete();
  
  // 3. BusinessCard
  await db.businessCards.where('profileId').anyOf(profileIds).delete();
  
  // 4. Tag
  await db.tags.where('userId').equals(userId).delete();
  
  // 5. MyProfile
  await db.myProfiles.where('userId').equals(userId).delete();
  
  // 6. BackupHistory
  await db.backupHistories.where('userId').equals(userId).delete();
  
  // 7. Session
  await db.sessions.where('userId').equals(userId).delete();
  
  // 8. UserSetting
  await db.userSettings.where('userId').equals(userId).delete();
  
  // 9. User
  await db.users.delete(userId);
};
```

---

### 3.3 OCR機能

#### 3.3.1 OCR処理方式

| 方式 | 用途 | 備考 |
|------|------|------|
| クラウドOCR（推奨） | 通常時の高精度認識 | Google Cloud Vision API等 |
| ローカルOCR | フォールバック、オフライン時 | Tesseract.js v5 |

#### 3.3.2 クラウドOCR処理フロー

| ステップ | 処理内容 | 進捗% |
|----------|----------|-------|
| 1 | 画像のリサイズ・正規化（最大2000px） | 10% |
| 2 | 画像圧縮（JPEG品質85%） | 15% |
| 3 | Cloud Vision APIへ送信 | 20% |
| 4 | OCR結果受信 | 60% |
| 5 | LLMで構造化処理 | 90% |
| 6 | フォームへマッピング | 100% |

#### 3.3.3 ローカルOCR処理フロー（フォールバック）

| ステップ | 処理内容 | 進捗% |
|----------|----------|-------|
| 1 | 画像のリサイズ・正規化（最大2000px） | 10% |
| 2 | グレースケール変換 | 20% |
| 3 | コントラスト調整・ノイズ除去 | 30% |
| 4 | Tesseract.jsで言語別OCR実行 | 80% |
| 5 | 正規表現による抽出・フォームマッピング | 100% |

#### 3.3.4 LLM構造化プロンプト

```
以下の名刺OCRテキストから、構造化データを抽出してください。

【OCRテキスト】
{ocr_text}

【出力形式】JSON
{
  "personName": "氏名",
  "personNameKana": "フリガナ（推測）",
  "companyName": "会社名",
  "department": "部署名",
  "position": "役職",
  "email": "メールアドレス",
  "phone": "電話番号",
  "mobile": "携帯番号",
  "address": "住所",
  "website": "Webサイト",
  "positionLevel": "EXECUTIVE|DIRECTOR|MANAGER|SECTION_CHIEF|STAFF|OTHER",
  "confidence": 0.0-1.0
}

不明な項目はnullとしてください。
```

#### 3.3.5 エラーハンドリングとフォールバック

```typescript
const performOCR = async (image: Blob, settings: UserSetting): Promise<OCRResult> => {
  // APIキーが設定されている場合はクラウドOCRを試行
  if (settings.cloudOcrApiKey) {
    try {
      const result = await cloudOCR(image, settings.cloudOcrApiKey);
      return result;
    } catch (error) {
      console.warn('Cloud OCR failed, falling back to local OCR', error);
      // フォールバック: ローカルOCR
    }
  }
  
  // ローカルOCR
  return await localOCR(image, settings.ocrLanguages);
};
```

| エラー種別 | 対応 |
|------------|------|
| API認証エラー | 「APIキーを確認してください」表示、設定画面へリンク |
| APIレート制限 | ローカルOCRにフォールバック |
| APIタイムアウト | リトライ後、ローカルOCRにフォールバック |
| ネットワークエラー | ローカルOCRにフォールバック |
| ローカルOCR失敗 | 「手動で入力してください」表示 |

---

### 3.4 重複検出機能

#### 3.4.1 検出ロジック

```typescript
const detectDuplicates = async (userId: string): Promise<DuplicatePair[]> => {
  const cards = await getAllUserCards(userId);
  const skips = await getSkippedPairs(userId);
  const duplicates: DuplicatePair[] = [];
  
  for (let i = 0; i < cards.length; i++) {
    for (let j = i + 1; j < cards.length; j++) {
      const card1 = cards[i];
      const card2 = cards[j];
      
      // スキップ済みペアは除外
      if (isSkipped(skips, card1.id, card2.id)) continue;
      
      const score = calculateDuplicateScore(card1, card2);
      
      if (score >= 0.7) {
        duplicates.push({ card1, card2, score });
      }
    }
  }
  
  return duplicates.sort((a, b) => b.score - a.score);
};

const calculateDuplicateScore = (card1: BusinessCard, card2: BusinessCard): number => {
  let score = 0;
  
  // メールアドレス完全一致: +0.5
  if (card1.email && card1.email === card2.email) {
    score += 0.5;
  }
  
  // 氏名＋会社名一致: +0.4
  if (card1.personName === card2.personName && 
      card1.companyName === card2.companyName) {
    score += 0.4;
  }
  
  // 氏名類似＋会社名一致: +0.3
  if (levenshteinDistance(card1.personName, card2.personName) <= 2 &&
      card1.companyName === card2.companyName) {
    score += 0.3;
  }
  
  // 電話番号一致: +0.3
  if (card1.phone && card1.phone === card2.phone) {
    score += 0.3;
  }
  
  return Math.min(score, 1.0);
};
```

#### 3.4.2 統合処理

```typescript
const mergeCards = async (
  keepCardId: string, 
  deleteCardId: string,
  mergedData: Partial<BusinessCard>
): Promise<void> => {
  // 保持する名刺を更新
  await db.businessCards.update(keepCardId, {
    ...mergedData,
    updatedAt: new Date()
  });
  
  // タグをマージ
  const deleteTags = await db.cardTags.where('cardId').equals(deleteCardId).toArray();
  for (const tag of deleteTags) {
    const exists = await db.cardTags.get([keepCardId, tag.tagId]);
    if (!exists) {
      await db.cardTags.add({ cardId: keepCardId, tagId: tag.tagId, createdAt: new Date() });
    }
  }
  
  // 画像をマージ
  const deleteImages = await db.businessCardImages.where('cardId').equals(deleteCardId).toArray();
  const keepImagesCount = await db.businessCardImages.where('cardId').equals(keepCardId).count();
  for (let i = 0; i < deleteImages.length; i++) {
    await db.businessCardImages.add({
      ...deleteImages[i],
      id: crypto.randomUUID(),
      cardId: keepCardId,
      displayOrder: keepImagesCount + i + 1
    });
  }
  
  // 削除する名刺の関連データを削除
  await db.cardTags.where('cardId').equals(deleteCardId).delete();
  await db.businessCardImages.where('cardId').equals(deleteCardId).delete();
  await db.duplicateSkips
    .filter(ds => ds.cardId1 === deleteCardId || ds.cardId2 === deleteCardId)
    .delete();
  
  // 名刺を削除
  await db.businessCards.delete(deleteCardId);
};
```

---

### 3.5 バックアップ・復元機能

#### 3.5.1 バックアップ形式

##### JSON形式

```json
{
  "version": "2.0.0",
  "exportedAt": "2025-01-17T10:30:00.000Z",
  "app": "MyCardManager",
  "user": {
    "email": "example@mail.com"
  },
  "data": {
    "profiles": [...],
    "cards": [...],
    "cardImages": [...],
    "tags": [...],
    "cardTags": [...],
    "settings": {...}
  }
}
```

##### ZIP形式

```
backup_20250117_103000.zip
├── manifest.json       # メタ情報
├── data.json          # 構造化データ（画像除く）
└── images/
    ├── profile_xxx.jpg
    ├── card_yyy_front.jpg
    ├── card_yyy_back.jpg
    └── ...
```

#### 3.5.2 復元処理

```typescript
const restoreBackup = async (
  file: File, 
  mode: 'overwrite' | 'merge'
): Promise<RestoreResult> => {
  const backup = await parseBackupFile(file);
  
  // バージョン互換性チェック
  if (!isCompatibleVersion(backup.version)) {
    throw new Error('このバックアップファイルは現在のバージョンと互換性がありません');
  }
  
  // マイグレーション実行（必要な場合）
  const migratedData = await migrateIfNeeded(backup);
  
  if (mode === 'overwrite') {
    // 既存データを削除
    await clearAllUserData(currentUserId);
  }
  
  // データ復元
  const result = await importData(migratedData, mode);
  
  // 履歴記録
  await db.backupHistories.add({
    id: crypto.randomUUID(),
    userId: currentUserId,
    backupType: file.name.endsWith('.zip') ? 'zip' : 'json',
    schemaVersion: backup.version,
    cardCount: result.cardCount,
    fileSize: file.size,
    createdAt: new Date()
  });
  
  return result;
};
```

---

### 3.6 CSV出力機能

```typescript
const exportToCSV = async (
  options: ExportOptions
): Promise<Blob> => {
  // 対象データ取得
  let cards: BusinessCard[];
  if (options.target === 'all') {
    cards = await getAllUserCards(currentUserId);
  } else if (options.target === 'filtered') {
    cards = await getFilteredCards(options.filterState);
  } else {
    cards = await getCardsByIds(options.selectedIds);
  }
  
  // CSV行生成
  const rows: string[][] = [];
  
  // ヘッダー
  rows.push(generateHeader(options.fields));
  
  // データ行
  for (const card of cards) {
    rows.push(await generateRow(card, options.fields));
  }
  
  // CSV文字列生成
  const csvContent = rows.map(row => 
    row.map(cell => `"${cell.replace(/"/g, '""')}"`).join(',')
  ).join('\n');
  
  // エンコーディング
  const encoder = options.encoding === 'shift-jis' 
    ? new TextEncoder('shift-jis')
    : new TextEncoder();
  
  return new Blob([encoder.encode(csvContent)], { type: 'text/csv' });
};
```

---

## 4. 技術仕様

### 4.1 技術スタック

| レイヤー | 技術 | 備考 |
|----------|------|------|
| フレームワーク | React 18 + TypeScript | コンポーネントベース開発 |
| 状態管理 | Zustand | 軽量な状態管理 |
| スタイリング | Tailwind CSS | ユーティリティファースト |
| ローカルDB | IndexedDB (Dexie.js) | 構造化データ保存 |
| OCR（クラウド） | Google Cloud Vision API | 高精度OCR（推奨） |
| OCR（ローカル） | Tesseract.js v5 | フォールバック用 |
| AI構造化 | Claude API (Anthropic) | テキスト構造化・推論 |
| 会社情報API | 法人番号API（国税庁） | 会社情報補完 |
| 画像処理 | browser-image-compression | 画像リサイズ・圧縮 |
| 認証 | bcryptjs | パスワードハッシュ化 |
| トークン生成 | crypto-js / Web Crypto API | セッショントークン生成 |
| ZIP処理 | JSZip | バックアップZIP作成 |
| 仮想スクロール | react-window | 大量データの効率的表示 |
| ドラッグ&ドロップ | @dnd-kit | 所属の並び替え |
| HTTP通信 | axios | 外部API通信 |
| ビルド | Vite | 高速ビルド |
| テスト | Vitest + React Testing Library | ユニット・結合テスト |

---

### 4.2 ディレクトリ構成

```
src/
├── components/           # UIコンポーネント
│   ├── common/           # 共通コンポーネント
│   │   ├── Button/
│   │   ├── Modal/
│   │   ├── Toast/
│   │   ├── Loading/
│   │   └── ...
│   ├── layout/           # レイアウトコンポーネント
│   │   ├── Header/
│   │   ├── Sidebar/
│   │   └── ...
│   ├── dashboard/        # ダッシュボード関連
│   │   ├── CardList/
│   │   ├── FilterBar/
│   │   ├── ProfilePanel/
│   │   └── ...
│   ├── card/             # 名刺関連
│   │   ├── CardDetail/
│   │   ├── CardForm/
│   │   ├── CardImage/
│   │   └── ...
│   ├── auth/             # 認証関連
│   │   ├── LoginForm/
│   │   ├── RegisterForm/
│   │   └── ...
│   └── settings/         # 設定関連
│       ├── SettingsForm/
│       ├── BackupPanel/
│       └── ...
├── hooks/                # カスタムフック
│   ├── useAuth.ts
│   ├── useSession.ts
│   ├── useCards.ts
│   └── ...
├── stores/               # Zustand ストア
│   ├── authStore.ts
│   ├── cardStore.ts
│   ├── filterStore.ts
│   └── ...
├── services/             # ビジネスロジック
│   ├── db/               # IndexedDB操作
│   │   ├── index.ts
│   │   ├── migrations.ts
│   │   └── ...
│   ├── auth/             # 認証処理
│   ├── ocr/              # OCR処理
│   ├── backup/           # バックアップ処理
│   ├── export/           # エクスポート処理
│   └── duplicate/        # 重複検出処理
├── types/                # 型定義
│   ├── models.ts
│   ├── api.ts
│   └── ...
├── constants/            # 定数定義
│   ├── masters.ts        # マスタデータ
│   └── ...
├── utils/                # ユーティリティ
│   ├── validation.ts
│   ├── format.ts
│   └── ...
├── pages/                # ページコンポーネント
│   ├── Login.tsx
│   ├── Dashboard.tsx
│   ├── CardDetail.tsx
│   └── ...
└── App.tsx               # エントリポイント
```

---

### 4.3 パフォーマンス目標

| 項目 | 目標値 | 実現方法 |
|------|--------|----------|
| 初期表示 | 2秒以内 | コード分割、遅延ローディング |
| 名刺一覧表示（1000件） | 1秒以内 | 仮想スクロール（react-window） |
| ソート・フィルター | 0.5秒以内 | インデックス活用、メモ化 |
| OCR処理 | 10秒以内 | Web Worker、画像前処理最適化 |
| バックアップ生成（1000件） | 30秒以内 | 非同期処理、進捗表示 |

---

### 4.4 データ容量見積もり

| 項目 | サイズ | 1000件時の合計 |
|------|--------|----------------|
| 名刺1件（テキストデータ） | 約2KB | 約2MB |
| 名刺画像（表面、圧縮後） | 約150KB | 約150MB |
| 名刺画像（裏面、圧縮後） | 約150KB | 約150MB（任意） |
| 合計（画像1枚/件） | 約152KB | 約152MB |
| 合計（画像2枚/件） | 約302KB | 約302MB |

---

## 5. 改訂履歴

| Ver | 日付 | 内容 |
|-----|------|------|
| 1.0 | 2025/01/17 | 初版作成 |
| 2.0 | 2025/01/17 | 認証方式統一（bcryptjs）、セッション管理詳細化、削除処理の整合性確保、新規テーブル追加（Session, UserSetting, BusinessCardImage, BackupHistory）、マスタデータ定義追加、画面設計詳細化（設定画面、CSVエクスポート画面、エラー表示、ローディング表示）、ページネーション設計追加、名刺登録フロー改善 |
| 3.0 | 2026/01/18 | MyProfileにstartDate/endDate/isCurrentフィールド追加、Auto-Syncサービス（autoSyncService, fileSyncService）の実装、ログイン画面からの復元機能追加、StarRatingコンポーネント実装 |
